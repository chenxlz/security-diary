![image](assets/wallpaper_5228834-20230207221228-s3qagsd.jpg)

# React

# Reactç›¸å…³æ¦‚å¿µ

### å…³äºJSX

ã€€ã€€**JSX** æ˜¯ JavaScript è¯­æ³•æ‰©å±•ï¼Œå¯ä»¥è®©ä½ åœ¨ JavaScript æ–‡ä»¶ä¸­ä¹¦

ã€€ã€€[JSX and React æ˜¯ç›¸äº’ç‹¬ç«‹çš„](https://reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html#whats-a-jsx-transform) ä¸œè¥¿ã€‚ä½†å®ƒä»¬ç»å¸¸ä¸€èµ·ä½¿ç”¨ï¼Œä½†ä½  **å¯ä»¥** å•ç‹¬ä½¿ç”¨å®ƒä»¬ä¸­çš„ä»»æ„ä¸€ä¸ªï¼ŒJSX æ˜¯ä¸€ç§è¯­æ³•æ‰©å±•ï¼Œè€Œ React åˆ™æ˜¯ä¸€ä¸ª JavaScript çš„åº“ã€‚å†™ç±»ä¼¼ HTML çš„æ ‡ç­¾ã€‚

### JSXè§„åˆ™

1. åªèƒ½è¿”å›ä¸€ä¸ªæ ¹å…ƒç´   
    å¦‚æœæƒ³è¦åœ¨ä¸€ä¸ªç»„ä»¶ä¸­åŒ…å«å¤šä¸ªå…ƒç´ ï¼Œ**éœ€è¦ç”¨ä¸€ä¸ªçˆ¶æ ‡ç­¾æŠŠå®ƒä»¬åŒ…è£¹èµ·æ¥**ã€‚å¦‚`<div></div>`â€‹ æˆ–è€…è¯´`â€‹ <></>`â€‹  
    JSXçš„åº•å±‚æ˜¯æŠŠå†…å®¹éƒ½è½¬åŒ–æˆå¯¹è±¡ï¼Œä¸€ä¸ªå‡½æ•°ä¸­åªèƒ½è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œé™¤éæ˜¯è¿”å›çš„ä¸€ä¸ªæ•°ç»„å†…å®¹ã€‚
2. æ ‡ç­¾å¿…é¡»é—­åˆ  
    å³åŸæ¥htmlä¸­çš„å¯ä»¥ä¸é—­åˆæ ‡ç­¾åœ¨jsxä¸­å¿…é¡»é—­åˆï¼Œä¸ç„¶ä¼šå‡ºç°æŠ¥é”™ä¿¡æ¯
3. ä½¿ç”¨é©¼å³°å‘½å ~~æ‰€æœ‰~~ å¤§éƒ¨åˆ†å±æ€§å‘½å  
    jsxåº•å±‚æ˜¯è½¬åŒ–æˆå¯¹è±¡ï¼Œæ‰€ä»¥è¦éµå®ˆjså¯¹ å¯¹è±¡ å‘½åæ—¶å€™çš„è§„åˆ™ï¼Œå¦‚ä¸èƒ½å‡ºç° ä¸­åˆ’çº¿ - ï¼Œ ä¸èƒ½ä½¿ç”¨ class è¿™ç§å†…ç½®å…³é”®å­—ç­‰ï¼Œæ‰€ä»¥ä½¿ç”¨ `class`â€‹ å¯ä»¥å†™æˆ `className`â€‹ è¿™ç§æ–¹å¼
4. ä½¿ç”¨èŠ±æ‹¬å·`{}`â€‹åœ¨jsxä¸­å†™ js é€»è¾‘éƒ¨åˆ†ï¼Œå¦‚æœéœ€è¦åœ¨é‡Œé¢ä½¿ç”¨å¯¹è±¡çš„è¯ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨åŒèŠ±æ‹¬å·`{{}}`â€‹ï¼Œå¤–é¢ä¸€æ¬¡è¡¨ç¤ºjsåŒºåŸŸï¼Œé‡Œé¢ä¸€æˆè¡¨ç¤ºå€¼ä¸ºå¯¹è±¡

### çº¯å‡½æ•°å’Œå‰¯ä½œç”¨

1. çº¯å‡½æ•°ï¼šç®€å•ç†è§£å°±æ˜¯è¾“å…¥ä»€ä¹ˆï¼Œå°±æ°¸è¿œè¾“å‡ºä»€ä¹ˆä¸ä¼šå‘ç”Ÿæ”¹å˜

    * **åªè´Ÿè´£è‡ªå·±çš„ä»»åŠ¡**ã€‚å®ƒä¸ä¼šæ›´æ”¹åœ¨è¯¥å‡½æ•°è°ƒç”¨å‰å°±å·²å­˜åœ¨çš„å¯¹è±¡æˆ–å˜é‡
    * **è¾“å…¥ç›¸åŒï¼Œåˆ™è¾“å‡ºç›¸åŒ**ã€‚ç»™å®šç›¸åŒçš„è¾“å…¥ï¼Œçº¯å‡½æ•°åº”æ€»æ˜¯è¿”å›ç›¸åŒçš„ç»“æœã€‚
2. å‰¯ä½œç”¨ï¼šä¼šå‡ºç°ä¸ç¬¦åˆé¢„æœŸçš„ç»“æœï¼Œä¼šå½±å“åˆ°ä¸å±äºè‡ªå·±å˜é‡ä¹‹å¤–çš„å€¼çš„æ”¹å˜ï¼Œ

    * å¦‚ï¼šæ›´æ–°å±å¹•ã€å¯åŠ¨åŠ¨ç”»ã€æ›´æ”¹æ•°æ®ç­‰ï¼Œå®ƒä»¬æ˜¯ **â€œé¢å¤–â€** å‘ç”Ÿçš„äº‹æƒ…ï¼Œä¸æ¸²æŸ“è¿‡ç¨‹æ— å…³ã€‚
    * åœ¨ React ä¸­ï¼Œ**å‰¯ä½œç”¨é€šå¸¸å±äº â€‹**â€‹****ã€‚
    * äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯ React åœ¨ä½ æ‰§è¡ŒæŸäº›æ“ä½œï¼ˆå¦‚å•å‡»æŒ‰é’®ï¼‰æ—¶è¿è¡Œçš„å‡½æ•°
    * å³ä½¿äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯åœ¨ä½ çš„ç»„ä»¶ **å†…éƒ¨** å®šä¹‰çš„ï¼Œå®ƒä»¬ä¹Ÿä¸ä¼šåœ¨æ¸²æŸ“æœŸé—´è¿è¡Œï¼Œ**å› æ­¤äº‹ä»¶å¤„ç†ç¨‹åºæ— éœ€æ˜¯çº¯å‡½æ•°**ã€‚
3. reactä½¿ç”¨çº¯å‡½æ•°ç¼–å†™çš„åŸå› 

    * å¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹è¿è¡Œï¼Œæ€»æ˜¯è¿”å›ç›¸åŒçš„ç»“æœ
    * å¯ä»¥ä¸ºé‚£äº›è¾“å…¥æœªæ›´æ”¹çš„ç»„ä»¶æ¥ [è·³è¿‡æ¸²æŸ“](https://zh-hans.react.dev/reference/react/memo)ï¼Œä»¥æé«˜æ€§èƒ½ã€‚è¿™æ˜¯å®‰å…¨çš„åšæ³•ï¼Œå› ä¸ºçº¯å‡½æ•°æ€»æ˜¯è¿”å›ç›¸åŒçš„ç»“æœï¼Œæ‰€ä»¥å¯ä»¥å®‰å…¨åœ°ç¼“å­˜å®ƒä»¬ã€‚
    * å¦‚æœåœ¨æ¸²æŸ“æ·±å±‚ç»„ä»¶æ ‘çš„è¿‡ç¨‹ä¸­ï¼ŒæŸäº›æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼ŒReact å¯ä»¥é‡æ–°å¼€å§‹æ¸²æŸ“ï¼Œè€Œä¸ä¼šæµªè´¹æ—¶é—´å®Œæˆè¿‡æ—¶çš„æ¸²æŸ“ã€‚çº¯ç²¹æ€§ä½¿å¾—å®ƒéšæ—¶å¯ä»¥å®‰å…¨åœ°åœæ­¢è®¡ç®—ã€‚

### hook

ã€€ã€€åœ¨reactä¸­ï¼Œæ‰€æœ‰ä»¥ `use`â€‹ å¼€å¤´çš„å‡½æ•°éƒ½è¢«å«åš hook

ã€€ã€€hookæ˜¯ç‰¹æ®Šå‡½æ•°ï¼Œåªåœ¨reactæ¸²æŸ“æ—¶æœ‰æ•ˆï¼Œåªèƒ½åœ¨ç»„ä»¶æˆ–è‡ªå®šä¹‰hookçš„æœ€é¡¶å±‚è°ƒç”¨

### æ•°æ®å¿«ç…§

ã€€ã€€reactä¸­ï¼Œåˆå§‹åŒ–çš„stateæ•°æ®å…¶å®æ˜¯ä¸€ç›´ä¿ç•™çš„ï¼Œæ›´æ”¹æ•°æ®ä¸èƒ½ç›´æ¥æ›´æ”¹stateçš„å€¼ï¼Œéœ€è¦åœ¨setStateå‡½æ•°ä¸­ä¼ å…¥éœ€è¦æ”¹å˜çš„å€¼ï¼Œä¹‹åä¼šä¿å­˜ä¸€ä¸ªæ•°æ®å¿«ç…§ï¼Œç„¶åé€šçŸ¥reactè¿›è¡Œæ¸²æŸ“ã€‚

ã€€ã€€ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æŠŠéœ€è¦çš„å€¼ä½œä¸ºå‚æ•°ä¼ å…¥åˆ°setStateå‡½æ•°ä¸­ï¼ŒåŸæ¥çš„stateæ˜¯ä¸ä¼šæ”¹å˜çš„

ã€€ã€€**ä¸€ä¸ª state å˜é‡çš„å€¼æ°¸è¿œä¸ä¼šåœ¨ä¸€æ¬¡æ¸²æŸ“çš„å†…éƒ¨å‘ç”Ÿå˜åŒ–**

### è§†å›¾æ›´æ–°

ã€€ã€€**React ä¼šç­‰åˆ°äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„** æ‰€æœ‰ **ä»£ç éƒ½è¿è¡Œå®Œæ¯•å†å¤„ç†ä½ çš„ state æ›´æ–°ã€‚**

ã€€ã€€é‡æ–°æ¸²æŸ“åªä¼šå‘ç”Ÿåœ¨æ‰€æœ‰ `setState()`â€‹ è°ƒç”¨ **ä¹‹å** çš„åŸå› ã€‚

### [æ›´æ–°state](https://zh-hans.react.dev/learn/queueing-a-series-of-state-updates)

ã€€ã€€ä½¿ç”¨`setState`â€‹å‡½æ•°çš„æ—¶å€™ï¼Œä¼ å…¥å€¼æ˜¯å½¢æˆä¸€ä¸ªæ•°æ®å¿«ç…§ï¼ŒåŸæ¥çš„stateå…¶å®æ˜¯æ²¡æœ‰æ”¹å˜çš„

ã€€ã€€å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚ï¼š`setState((n)=>n+1)`â€‹ ï¼Œè¯¥å›è°ƒå‡½æ•°ç§°ä¸º `æ›´æ–°å‡½æ•°`â€‹  ã€‚`n`â€‹æ˜¯ä¸Šä¸€ä¸ªstateè¿”å›çš„å€¼

1. React ä¼šå°†æ­¤å‡½æ•°åŠ å…¥é˜Ÿåˆ—ï¼Œä»¥ä¾¿åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„æ‰€æœ‰å…¶ä»–ä»£ç è¿è¡Œåè¿›è¡Œå¤„ç†ã€‚
2. åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æœŸé—´ï¼ŒReact ä¼šéå†é˜Ÿåˆ—å¹¶ç»™ä½ æ›´æ–°ä¹‹åçš„æœ€ç»ˆ stateã€‚

```js
ä¸€ä¸ªæ›´æ–°å‡½æ•°ï¼ˆä¾‹å¦‚ï¼šn => n + 1ï¼‰ä¼šè¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚
ä»»ä½•å…¶ä»–çš„å€¼ï¼ˆä¾‹å¦‚ï¼šæ•°å­— 5ï¼‰ä¼šå¯¼è‡´â€œæ›¿æ¢ä¸º 5â€è¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œå·²ç»åœ¨é˜Ÿåˆ—ä¸­çš„å†…å®¹ä¼šè¢«å¿½ç•¥ã€‚
```

### reactæ ·å¼

ã€€ã€€å…³äº`react`â€‹ä¸­å†™æ ·å¼çš„é—®é¢˜ï¼Œç›®å‰æ¥è¯´æ²¡æœ‰æ¯”è¾ƒç»Ÿä¸€çš„æ–¹æ¡ˆï¼Œreactæ¯”è¾ƒæ¨èçš„æ˜¯ç›´æ¥åœ¨ç»„ä»¶ä¸­å†™è¡Œå†…æ ·å¼ã€‚å› ä¸ºä¸€ä¸ªç»„ä»¶å°±æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œç›´æ¥åœ¨ç»„ä»¶å†…éƒ¨å†™è¡Œå†…æ ·å¼å³å¯ã€‚

ã€€ã€€ä¹Ÿå¯ä»¥å•ç‹¬çš„æ‹¿ä¸€ä¸ªæ–‡ä»¶å¤¹æ¥å­˜æ”¾ `css â€‹`â€‹æ ·å¼æ–‡ä»¶ï¼Œåœ¨ç»„ä»¶éœ€è¦çš„åœ°æ–¹ï¼Œ ä½¿ç”¨ `import â€‹`â€‹å¯¼å…¥ä½¿ç”¨å³å¯

### å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶

* ç±»ç»„ä»¶ï¼šES6çš„åŠ å…¥è®©`JavaScript`â€‹ç›´æ¥æ”¯æŒä½¿ç”¨`class`â€‹æ¥å®šä¹‰ä¸€ä¸ªç±»ï¼Œ`react`â€‹åˆ›å»ºç»„ä»¶çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨çš„ç±»çš„ç»§æ‰¿ï¼Œ `ES6 class â€‹`â€‹æ˜¯ç›®å‰å®˜æ–¹æ¨èçš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä½¿ç”¨äº†ES6æ ‡å‡†è¯­æ³•æ¥æ„å»º

  ```js
  import React from 'react'
  import ReactDOM from 'react-dom'

  class App extends React.Component {
  render () {
    return (<h1>æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ</h1>)
    }
  }
  ReactDOM.render(
  <App/>,
  document.getElementById('root')
  )
  ```
* å‡½æ•°å¼ç»„ä»¶

  ```js
  import React from 'react'
  import ReactDOM from 'react-dom'

  const App = (props) => <h1>æ¬¢è¿è¿›å…¥Reactçš„ä¸–ç•Œ</h1>
  ReactDOM.render(
    // Reactç»„ä»¶çš„è°ƒç”¨æ–¹å¼
    <App/>,
    document.getElementById('root')
  )
  ```

### äº‹ä»¶å¤„ç†

* äº‹ä»¶ç»‘å®š

  ```js
  reactä¸­çš„äº‹ä»¶ç»‘å®šï¼Œä½¿ç”¨ on + äº‹ä»¶åæ–¹å¼æ¥ç»‘å®šäº‹ä»¶
  reactçš„äº‹ä»¶ç»‘å®šå’ŒåŸç”Ÿçš„äº‹ä»¶ç»‘å®šæ˜¯ä¸ä¸€æ ·çš„
  åŸç”Ÿäº‹ä»¶éƒ½æ˜¯å°å†™  onclick 
  react æ˜¯é©¼å³°å†™æ³• onClick
  reactçš„äº‹ä»¶ä¸æ˜¯åŸç”Ÿäº‹ä»¶ï¼Œå¹¶ä¸æ˜¯ç»‘å®šåœ¨domä¸Šçš„ï¼Œè€Œæ˜¯åˆæˆäº‹ä»¶ï¼Œæœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†æœºåˆ¶ï¼Œäº‹ä»¶å¥½åƒæ˜¯åœ¨æ ¹èŠ‚ç‚¹ç»Ÿä¸€å¤„ç†ï¼Œé€šè¿‡äº‹ä»¶å†’æ³¡æ¥çš„
  ```
* â€‹`event`â€‹å¯¹è±¡

  ```js
  eventå¯¹è±¡
  å’Œæ™®é€šæµè§ˆå™¨ä¸€æ ·ï¼Œäº‹ä»¶handlerä¼šè¢«è‡ªåŠ¨ä¼ å…¥ä¸€ä¸ª event å¯¹è±¡
  è¿™ä¸ªå¯¹è±¡å’Œæ™®é€šçš„æµè§ˆå™¨ event å¯¹è±¡æ‰€åŒ…å«çš„æ–¹æ³•å’Œå±æ€§éƒ½åŸºæœ¬ä¸€è‡´ã€‚
  ä¸åŒçš„æ˜¯ Reactä¸­çš„ event å¯¹è±¡å¹¶ä¸æ˜¯æµè§ˆå™¨æä¾›çš„ï¼Œè€Œæ˜¯å®ƒè‡ªå·±å†…éƒ¨æ‰€æ„å»ºçš„ã€‚
  å®ƒåŒæ ·å…·æœ‰ event.stopPropagationã€event.preventDefault è¿™ç§å¸¸ç”¨çš„æ–¹æ³•
  ```

### ref

```js
æ¨èçš„è·å–refçš„æ–¹æ³•
1.å®šä¹‰éœ€è¦çš„ref
const myRef = React.createRef()
2.æŒ‚è½½ref
<div ref={this.myRef}>hello</div>
3.è·å–ref
this.myRef.current

è€æ–¹æ³•
1.æŒ‚è½½ref
<div ref=myRef>hello</div>
2.è·å–ref
this.refs.myRef.current

refä½¿ç”¨ç®­å¤´å‡½æ•°è¿”å›ç»„ä»¶å®ä¾‹
è®¾ç½®å˜é‡æ¥å—
let myRef = null
å†ç»„ä»¶ä¸­è·å–
<div ref={ el => this.myRef = el }>hello</div>

```

### state

* ç±»ç»„ä»¶ä¸­ç›´æ¥å®šä¹‰

  ```js
  class App extends Component {
    state = {
      ...
    }
  }
  ```
* ä½¿ç”¨ç±»çš„ `constructor â€‹`â€‹å‡½æ•°

  ```js
  class App extends Component {
    constructor(){
      super()//æ‰§è¡Œçˆ¶ç»„ä»¶ä¸­çš„constructor
      this.state = {
        ...
      }
    }
  }
  ```
* setStateï¼šç”¨äºæ”¹å˜ç»„ä»¶çŠ¶æ€çš„æ–¹æ³•

  ```js
  ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯æ–¹æ³•returnä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå‚æ•°å«åš updater
  handleChange(){
    this.setState({
      ...stateä¸­éœ€è¦è¢«æ›¿æ¢çš„å†…å®¹
    })
  }
  handleChange(){
    this.setState((prevState,props)=>{
      return {
        ...
      }
    })
  }

  è¯¥å‡½æ•°æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œå‚æ•°çš„å½¢å¼æ˜¯å›è°ƒå‡½æ•°ï¼Œä¼šåœ¨stateæ”¹å˜ä¹‹åï¼Œdomæ›´æ–°å®Œæˆä¹‹åè°ƒç”¨
  handleChange(){
    this.setState({
      ...stateä¸­éœ€è¦è¢«æ›¿æ¢çš„å†…å®¹
    },()=>{})
  }

  ps:
  setState æ–¹æ³•æ˜¯ å¼‚æ­¥è°ƒç”¨ çš„ï¼Œreactä¸ºäº†é¿å…é¢‘ç¹çš„ä¿®æ”¹çŠ¶æ€ï¼Œä¼šç»Ÿä¸€çš„æŠŠstateå˜åŒ–æ’åˆ—åˆ°é˜Ÿä¼ä¸­
  1.ä¸Šé¢è¿™ä¸ª å¼‚æ­¥ æ˜¯reactçš„ä¼˜åŒ–æ‰‹æ®µï¼Œ this.setState åœ¨åŒæ­¥ä¸­ï¼Œæ˜¯å¼‚æ­¥çš„
  2.åœ¨å¼‚æ­¥ä¸­ï¼Œthis.setState æ˜¯åŒæ­¥çš„
  setTime(()=>{
    this.setState({})
    this.setState({})
  })
  ```

### reactä¸­çš„v-html

```js
reactä¸­ä½¿ç”¨ dangerouslySetInnerHTML æ¥å®ç°v-htmlçš„åŠŸèƒ½

<div dangerouslySetInnerHTML={ { __html:this.state.htmlContent } }></div>
```

### reactä¸­çš„css

ã€€ã€€â€‹`react`â€‹ä¸­çš„`css`â€‹æ ·å¼ä¼šä½¿ç”¨è¡Œå†…å†™æ³•ï¼Œå› ä¸º`react`â€‹å¼•å…¥ä½¿ç”¨çš„`css`â€‹æ–‡ä»¶æ˜¯å…¨å±€çš„æ ·å¼ï¼Œè¿™ä¼šå¯¼è‡´åœ¨ç»„ä»¶å¯¼å…¥çš„`css`â€‹æ–‡ä»¶æ ·å¼å½±å“åˆ°åˆ«çš„ç»„ä»¶ï¼Œè€Œå¯¼è‡´çš„æ ·å¼é”™ä¹±ã€‚

```js
//reactä¸­çš„å¯¼å…¥cssæ–‡ä»¶ï¼Œè¿™æ ·å¯¼å…¥è™½ç„¶ç”Ÿæ•ˆï¼Œå¯å®é™…æ˜¯å…¨å±€çš„æ ·å¼
import "../css/home.css"
```

ã€€ã€€vueä¸­ï¼Œä¸€ä¸ª `.vue`â€‹æ–‡ä»¶ï¼Œé‡Œé¢å°±æœ‰åŒºåˆ†å‡ºæ¥ï¼Œ`template`â€‹ã€`style`â€‹ã€`js`â€‹ éƒ¨åˆ†ï¼Œ`vue`â€‹ä¸­çš„`style`â€‹æ˜¯æœ‰é€šè¿‡`â€‹ v-data-hash â€‹`â€‹å±æ€§æ¥åŒºåˆ†ç»„ä»¶ï¼Œé¿å…å¯¼è‡´ç»„ä»¶é—´çš„æ ·å¼æ¥ç›¸äº’å½±å“ã€‚

ã€€ã€€â€‹`react`â€‹è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œè¦ä½¿ç”¨`â€‹ css module â€‹`â€‹çš„æ¨¡å—åŒ–è¯­æ³•ã€‚

* å†…è”æ ·å¼ï¼šä¸å¤ªæ¨è

  ```js
  1.è¡Œå†…æ ·å¼å†™å¤šäº†ï¼Œå¯¼è‡´æ•´ä¸ªç»„ä»¶ç»“æ„çœ‹èµ·æ¥æ€ªæ€ªçš„ï¼Œè¦æ˜¯æ ·å¼å¤ªå¤šï¼Œé‚£é€»è¾‘ã€æ ·å¼å°±å…¨åœ¨ä¸€èµ·äº†
  2.ä¸æ”¯æŒ ä¼ªç±» çš„é€‰æ‹©å™¨
  ```
* â€‹`css module`â€‹ï¼šç»„ä»¶é—´çš„æ ·å¼ä¸ä¼šç›¸äº’å½±å“ï¼Œç±»åå‘ç”Ÿå˜åŒ–ï¼Œåé¢æ·»åŠ äº† hash å€¼ã€‚ä½¿ç”¨ classname.module.css å¯¼å…¥åˆ°ç»„ä»¶ä¸­ï¼Œæ˜¯ä¸ªå˜é‡ã€‚

  ```js
  æ–‡ä»¶å.module.css //å¼€å¯æ¨¡å—åŒ–
  /* home: index.module.css */
  :gole
  .content {
    color: orange;
    ...å†…å®¹
  }

  ç»„ä»¶ä¸­ï¼š
  import styles from "./index.module.css"; //å¯¼å…¥åæ˜¯ä¸ªå¯¹è±¡ï¼Œåœ¨ç»„ä»¶ä¸­ä½¿ç”¨ calssName = { style.content }
  const Home = () => {
   Â return <div className={styles.content}>æˆ‘æ˜¯ home é¡µé¢çš„ content</div>;
  };

  export default Home;
  ```
* â€‹`css in js`â€‹ï¼šè¿™ä¸ªéœ€è¦ä½¿ç”¨åº“ï¼Œå„ç§å•¥çš„`â€‹ css in js â€‹`â€‹å’Œ`â€‹ all in js`â€‹

ã€€ã€€â€

ã€€ã€€â€

# ReactåŸºç¡€

## ç»„ä»¶é€šä¿¡

### çŠ¶æ€æå‡

ã€€ã€€å°½å¯èƒ½ä½¿ç”¨å—æ§ç»„ä»¶ï¼Œç»„ä»¶ä¸ä½¿ç”¨å†…éƒ¨çš„ `çŠ¶æ€`â€‹ï¼Œ ä½¿ç”¨ çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ `å±æ€§`â€‹ æ¥æ§åˆ¶ç»„ä»¶çš„æ˜¾ç¤ºã€‚

ã€€ã€€å¯¹äºå¤šä¸ªå­ç»„ä»¶ä¹‹é—´çš„é€šè®¯ï¼Œä½¿ç”¨`â€‹ çŠ¶æ€æå‡ â€‹`â€‹ï¼Œå­ç»„ä»¶å†…çš„æ•°æ®å±•ç¤ºéƒ½ä½¿ç”¨çˆ¶ç»„ä»¶çš„çŠ¶æ€ï¼Œå¹¶æŠŠæ”¹å˜çˆ¶ç»„ä»¶å†…çŠ¶æ€çš„å‡½æ•°ä¼ é€’ç»™å­ç»„ä»¶ä½¿ç”¨ï¼Œä»è€Œè¾¾åˆ°å­ç»„ä»¶é€šè®¯ï¼Œå…±äº«å±æ€§çš„æ•ˆæœ

### è®¢é˜…å‘å¸ƒ

ã€€ã€€ç±»ä¼¼äºvueä¸­çš„eventBusã€‚

ã€€ã€€æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œåˆ›å»ºä¸ªå¯¹è±¡ï¼Œé‡Œé¢ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºæ”¶é›† ç»„ä»¶è®¢é˜…è§¦å‘äº‹ä»¶çš„å‡½æ•°ï¼Œ ä¸€ä¸ª`subscribe`â€‹å‡½æ•°ç”¨äºæ¥å—è®¢é˜…å‡½æ•°ï¼Œä¸€ä¸ª `publish`â€‹å‡½æ•°ç”¨äºè§¦å‘äº‹ä»¶ï¼ŒæŠŠäº‹ä»¶å¯¹äºçš„å‡½æ•°æ‰§è¡Œã€‚

ã€€ã€€è¾¾åˆ°ä¸€ä¸ªé›†ä¸­æ‰‹æœºäº‹ä»¶ï¼Œå¹¶æä¾›è§¦å‘çš„ä¸€ä¸ªå¹³å°å¯¹è±¡ã€‚

* äº‹ä»¶å¹³å°ä¸­å¿ƒåˆ›å»º

  ```js
  //è°ƒåº¦ä¸­å¿ƒ
  var bus = {
      list:[],
      //è®¢é˜…
      subscribe(callback){
          this.list.push(callback)//ç»„ä»¶è®¢é˜…çš„è§¦å‘å‡½æ•°è¿›è¡Œæ”¶é›†
      },
      //å‘å¸ƒï¼Œéå†æ‰€æœ‰çš„listï¼Œ å°†å›è°ƒå‡½æ•°æ‰§è¡Œ
      publish(text){//textï¼Œç”¨äºæ¥æ”¶ publish çš„æè¿°å­—æ®µ
          this.list.forEach(callback=>{
              callback && callback(text)
          })
      }
  }
  ```
* è®¢é˜…è€…

  ```js
  è®¢é˜…è€…æŠŠè§¦å‘å‡½æ•°ç»™pushåˆ°listä¸­ï¼Œå¯ä»¥æºå¸¦å‚æ•°
  bus.subscribe((value)=>{
      console.log("2222",value)
  })
  ```
* å‘å¸ƒè€…

  ```js
  bus.publish('des')//ä¼ å…¥äº‹ä»¶çš„æè¿°å­—æ®µï¼Œç”¨äºè§¦å‘äº‹ä»¶
  ```

ã€€ã€€â€

### context

* æ¦‚å¿µï¼š`context`â€‹ ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œreactå¯ä»¥ä½¿ç”¨ `context`â€‹å¯¹å­ç»„ä»¶æä¾›ä¾èµ–ã€‚è¿™ä¸ªæ–¹æ³•å’Œvueä¸­çš„provideã€injectè›®åƒçš„
* åŸºæœ¬ä½¿ç”¨ï¼Œéœ€è¦`â€‹ React.createContext() â€‹`â€‹

  ```js
  import React, { Component } from 'react'
  const GlobalContext  = React.createContext() //åˆ›å»ºcontextå¯¹è±¡

  //çˆ¶ç»„ä»¶æä¾›ä¾èµ–
  export default class App extends Component {
      constructor() {
          super()
          this.state = {
              filmList: [],
              info: ""
          }
      }
      render() {
          return (//  éœ€è¦ä½¿ç”¨ xxx.Provider æ¥æä¾›ä¾èµ–ï¼Œéœ€è¦åœ¨ç»„ä»¶çš„æœ€å¤–å±‚è¿›è¡ŒåŒ…è£¹ã€‚ value æ¥æä¾›éœ€è¦ä¼ é€’çš„å‚æ•°
              <GlobalContext.Provider value={{
                  info: this.state.info,
                  changeInfo: (value) => {
                      this.setState({
                          info: value
                      })
                  }
              }}>
                  <div>
                     <FilmItem ></FilmItem>
                  </div>
              </GlobalContext.Provider>
          )
      }
  }
  //ä½¿ç”¨  xx.Consumer åŒ…è£¹ç»„ä»¶ï¼Œæ¥å¯¹çˆ¶ç»„ä»¶æä¾›çš„æ•°æ®è¿›è¡Œæ¶ˆè´¹ã€‚
  //åŒæ—¶è¦ä½¿ç”¨å›è°ƒå‡½æ•° ï¼ˆvalï¼‰=> { return ç»„ä»¶ } å½¢å¼ï¼Œé€šè¿‡valueå½¢å‚æ¥æ‹¿åˆ°value
  class FilmItem extends Component {
      render() {
          let { name, poster, grade, synopsis } = this.props
          return (
              <GlobalContext.Consumer>
                  {
                      (value) => {
                          console.log(value)
                          return <div className="filmitem" onClick={() => {
                              value.changeInfo(synopsis)
                          }}>
                              <div>è§‚ä¼—è¯„åˆ†ï¼š{grade}</div>
                          </div>
                      }
                  }
              </GlobalContext.Consumer>
          )
      }
  }
  ```

ã€€ã€€â€

ã€€ã€€â€

ã€€ã€€â€

## ç”Ÿå‘½å‘¨æœŸ

ã€€ã€€â€‹![image](assets/image-20230907231035-bfpvs4r.png)â€‹![image](assets/image-20230907231045-bd0k3wk.png)â€‹â€‹

### [æ¦‚è¿°](https://juejin.cn/post/7248890696819277885?searchId=202309072235420B1497972C1DF3676587)

* reactä¸­è‡ªå¸¦çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¥½åƒéƒ½æ˜¯ç±»ç»„ä»¶ä¸­çš„ï¼Œå‡½æ•°æ—¶ç»„ä»¶éœ€è¦ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸçš„åŠŸèƒ½ï¼Œéœ€è¦ä½¿ç”¨hooksæ¥å®ç°ã€‚
* ç”Ÿå‘½å‘¨æœŸä¸€è§ˆ

  ```js
  1.æŒ‚è½½
  constructor
  getDerivedStateFromProps
  render
  componentDidMount

  2.æ›´æ–°ï¼šsetStateã€useStateã€propså˜åŒ–ã€forceUpdate ä¼šè§¦å‘ç»„ä»¶çš„æ›´æ–°
  static  getDerivedStateFromProps ï¼ˆæ–°ï¼‰ //ç±»å˜é‡
  shouldComponentUpdate
  render
  getSnapshotBeforeUpdate ï¼ˆæ–°ï¼‰
  componentDidUpdate

  3.å¸è½½
  componentWillUnmount
  ```
* å°†è¢«åºŸå¼ƒçš„é’©å­ï¼šä» v16.3 å¼€å§‹åºŸå¼ƒäº† componentWillMountã€componentWillReceivePropsã€componentWillUpdate ä¸‰ä¸ªé’©å­ï¼Œå¹¶ä¸ºè¿™å‡ ä¸ªé’©å­æä¾›äº†åˆ«åã€‚ä»¥åˆ«åçš„æ–¹å¼å°±æ˜¯æ¥æ¶å¿ƒä½ çš„ï¼Œè®©ä½ ä¸è¦ä½¿ç”¨ğŸ¤£ã€‚

  ```js
  UNSAFE_componentWillMountï¼šå½“ç»„ä»¶è¢«æ¸²æŸ“å‡ºæ¥ä¹‹å‰
  UNSAFE_componentWillReceivePropsï¼šå½“ç»„ä»¶æ”¶åˆ°æ–°çš„propsä¹‹å‰
  UNSAFE_componentWillUpdateï¼šç»„ä»¶æ›´æ–°å‰
  ```
* åºŸå¼ƒåŸå› 

  ```js
  åœ¨v16ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œreactçš„æ›´æ–°è¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œreact åœ¨åŠ è½½æˆ–è€…æ›´æ–°ç»„ä»¶çš„è¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼ŒæœŸé—´ä¸å…è®¸å…¶ä»–çš„æ“ä½œï¼Œå¾€å¾€ä¸€ä¸ªä¸»çº¿ç¨‹é•¿æ—¶é—´è¢«å ç”¨ï¼Œä¼šå¯¼è‡´é¡µé¢æ€§èƒ½é—®é¢˜ã€‚
  è€Œ React Fiber çš„æœºåˆ¶: æŠŠæ›´æ–°è¿‡ç¨‹ç¢ç‰‡åŒ–ï¼Œåˆ©ç”¨æµè§ˆå™¨ requestIdleCallback å°†å¯ä¸­æ–­çš„ä»»åŠ¡è¿›è¡Œåˆ†ç‰‡å¤„ç†ï¼Œç»´æŠ¤æ¯ä¸€ä¸ªåˆ†ç‰‡çš„æ•°æ®ç»“æ„ï¼Œå°±æ˜¯Fiberï¼Œæ¯ä¸€ä¸ªå°ç‰‡çš„è¿è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œè¿™æ ·å”¯ä¸€çš„çº¿ç¨‹å°±ä¸ä¼šè¢«ç‹¬å ã€‚
  ```
* Fiber

  ```js
  1.æ¦‚å¿µ
  åœ¨è®¡ç®—æœºä¸­ï¼Œé™¤äº† è¿›ç¨‹ï¼ˆProcessï¼‰å’Œçº¿ç¨‹ï¼ˆThreadï¼‰çš„æ¦‚å¿µå¤–è¿˜æœ‰ä¸€ä¸ªåä¸º Fiber (çº¤ç»´)çš„æ¦‚å¿µï¼Œæ„æŒ‡æ¯”Threadæ›´ç»†çš„çº¿ï¼Œä¹Ÿå°±æ˜¯æ¯”çº¿ç¨‹æ§åˆ¶å¾—æ›´ç²¾å¯†çš„å¹¶å‘å¤„ç†æœºåˆ¶ã€‚
  Fiber æ˜¯ä¸€ä¸ªæ‰§è¡Œå•å…ƒä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ”¯æ’‘ Fiber æ„å»ºä»»åŠ¡çš„è¿è½¬ã€‚
  åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œreact å°†æ¸²æŸ“ä»»åŠ¡æ‹†åˆ†æˆäº†ä¸€ä¸ªä¸ªçš„å°ä»»åŠ¡è¿›è¡Œå¤„ç†ï¼Œæ¯ä¸€ä¸ªå°ä»»åŠ¡æŒ‡çš„å°±æ˜¯ Fiber èŠ‚ç‚¹çš„æ„å»ºã€‚
  æ‹†åˆ†çš„å°ä»»åŠ¡ä¼šåœ¨æµè§ˆå™¨çš„ç©ºé—²æ—¶é—´è¢«æ‰§è¡Œï¼Œæ¯ä¸ªä»»åŠ¡å•å…ƒæ‰§è¡Œå®Œæˆåï¼ŒReact éƒ½ä¼šæ£€æŸ¥æ˜¯å¦è¿˜æœ‰ç©ºä½™æ—¶é—´ï¼Œå¦‚æœæœ‰å°±äº¤æ¢ä¸»çº¿ç¨‹çš„æ§åˆ¶æƒã€‚
  Fiber çš„æ€»ä½“æ€è·¯å°±æ˜¯åˆ©ç”¨å¾ªç¯å’Œé“¾è¡¨ä»£æ›¿é€’å½’å»ä¼˜åŒ–æ€§èƒ½ï¼ŒFiber æ¶æ„æœ‰ä¸¤ä¸ªé˜¶æ®µï¼Œ

  render é˜¶æ®µè´Ÿè´£æ„æ¶ Fiber å¯¹è±¡å’Œé“¾è¡¨ï¼Œæ‰¾å‡ºéœ€è¦æ›´æ–°çš„ DOM
  commit é˜¶æ®µè´Ÿè´£å»æ„å»º DOM

  2.Fiber å¯¹ç”Ÿå‘½å‘¨æœŸçš„å½±å“
  åœ¨React Fiberä¸­ï¼Œä¸€æ¬¡æ›´æ–°è¿‡ç¨‹ä¼šåˆ†æˆå¤šä¸ªåˆ†ç‰‡å®Œæˆï¼Œæ‰€ä»¥å®Œå…¨æœ‰å¯èƒ½ä¸€ä¸ªæ›´æ–°ä»»åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œå°±è¢«å¦ä¸€ä¸ªæ›´é«˜ä¼˜å…ˆçº§çš„æ›´æ–°è¿‡ç¨‹æ‰“æ–­ï¼Œè¿™æ—¶ï¼Œä¼˜å…ˆçº§é«˜çš„æ›´æ–°ä»»åŠ¡ä¼šä¼˜å…ˆå¤„ç†å®Œï¼Œè€Œä½ä¼˜å…ˆçº§æ›´æ–°ä»»åŠ¡æ‰€åšçš„å·¥ä½œåˆ™ä¼šå®Œå…¨ä½œåºŸï¼Œç„¶åç­‰å¾…æœºä¼šé‡å¤´å†æ¥ã€‚
  React Fiberä¸€ä¸ªæ›´æ–°è¿‡ç¨‹è¢«åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ(Phase)ï¼šç¬¬ä¸€ä¸ªé˜¶æ®µReconciliation Phaseå’Œç¬¬äºŒé˜¶æ®µCommit Phaseã€‚

  ç¬¬ä¸€é˜¶æ®µï¼šæ„å»º Fiber å¯¹è±¡ï¼Œæ„å»ºé“¾è¡¨ï¼Œåœ¨é“¾è¡¨ä¸­æ ‡è®°è¦æ‰§è¡Œçš„ DOM æ“ä½œ ï¼Œè¿™ä¸ªé˜¶æ®µæ˜¯å¯ä»¥è¢«æ‰“æ–­çš„
  renderï¼š render æ˜¯çº¯å‡½æ•°èƒ½å¤Ÿè¢«å¤šæ¬¡è°ƒç”¨
  componentWillMount
  componentWillReceivePropsï¼š å³ä½¿å½“å‰ç»„ä»¶ä¸æ›´æ–°ï¼Œåªè¦çˆ¶ç»„ä»¶æ›´æ–°ä¹Ÿä¼šå¼•å‘è¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨ï¼Œå…è®¸è¢«å¤šæ¬¡è°ƒç”¨
  shouldComponentUpdateï¼šè¿™å‡½æ•°çš„ä½œç”¨å°±æ˜¯è¿”å›ä¸€ä¸ªtrueæˆ–è€…falseï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ï¼Œå¤šè°ƒå‡ æ¬¡ä¹Ÿæ²¡å…³ç³»
  componentWillUpdate

  ç¬¬äºŒé˜¶æ®µï¼šæ ¹æ®æ„å»ºå¥½çš„é“¾è¡¨DOM çš„ï¼Œæ›´æ–°DOMçš„è¿‡ç¨‹ä¸­ä¸ä¼šè¢«æ‰“æ–­
  componentDidMount
  componentDidUpdate
  componentWillUnmount

  åœ¨React Fiberä¸­ï¼Œç¬¬ä¸€é˜¶æ®µä¸­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°åœ¨ä¸€æ¬¡åŠ è½½å’Œæ›´æ–°è¿‡ç¨‹ä¸­å¯èƒ½ä¼šè¢«å¤šæ¬¡è°ƒç”¨ï¼ 
  React Fiber Reconciliation è¿™ä¸ªè¿‡ç¨‹æœ‰å¯èƒ½æš‚åœç„¶åç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥æŒ‚è½½å’Œæ›´æ–°ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­å°±æœ‰å¯èƒ½ä¸æ‰§è¡Œæˆ–è€…å¤šæ¬¡æ‰§è¡Œã€‚
  ```

### æŒ‚è½½é˜¶æ®µ

* constructorï¼šåªä¼šåœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™è§¦å‘ä¸€æ¬¡

  ```js
  1.è®¾ç½®åˆå§‹åŒ–çŠ¶æ€å‡½æ•°å†…éƒ¨ stateï¼šå› ä¸ºç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­ä»»ä½•å‡½æ•°éƒ½å¯èƒ½è¦è®¿é—® Stateï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸä¸­ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„æ„é€ å‡½æ•°ä¾¿æ˜¯åˆå§‹åŒ– state æœ€ç†æƒ³çš„åœ°æ–¹ã€‚
  2.ç»‘å®šæˆå‘˜å‡½æ•°ä¸Šä¸‹æ–‡å¼•ç”¨
  å› ä¸ºåœ¨ ES6 è¯­æ³•ä¸‹ï¼Œç±»çš„æ¯ä¸ªæˆå‘˜å‡½æ•°åœ¨æ‰§è¡Œæ—¶çš„ this å¹¶ä¸æ˜¯å’Œç±»å®ä¾‹è‡ªåŠ¨ç»‘å®šçš„ï¼›è€Œåœ¨æ„é€ å‡½æ•°ä¸­ this å°±æ˜¯å½“å‰ç»„ä»¶å®ä¾‹ï¼Œæ‰€ä»¥åœ¨æ„é€ å‡½æ•°ä¸­å°† this ä¸ºå½“å‰ç±»å®ä¾‹ï¼›
  å»ºè®®å®šä¹‰å‡½æ•°æ–¹æ³•æ—¶ç›´æ¥ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå°±æ— é¡»åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡Œå‡½æ•°çš„ bind æ“ä½œã€‚
  class Sample extends React.Component {
    constructor(props, context, updater) {
    //propsï¼šç»§æ‰¿ React.Component çš„å±æ€§æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸å¯å˜çš„ read-only
    //contextï¼šå…¨å±€ä¸Šä¸‹æ–‡ã€‚
    //updaterï¼šåŒ…å«ä¸€äº›æ›´æ–°æ–¹æ³•çš„å¯¹è±¡
    //this.setState æœ€ç»ˆè°ƒç”¨çš„æ˜¯ this.updater.enqueueSetState
    //this.forceUpdate æœ€ç»ˆè°ƒç”¨çš„æ˜¯ this.updater.enqueueForceUpdate æ–¹æ³•ï¼Œæ‰€ä»¥è¿™äº› API æ›´å¤šæ˜¯ React è°ƒç”¨ä½¿ç”¨ï¼Œæš´éœ²å‡ºæ¥ä»¥å¤‡å¼€å‘è€…ä¸æ—¶ä¹‹éœ€ã€‚
      super(props);
      this.state = {
        foo: 'InitailValue',
      };
    }
  }

  Sample.defaultProps = {
    bar: 'InitialValue',
  };
  ```
* static getDerivedStateFromPropsï¼šè¯¥å‡½æ•°ä¼šåœ¨ç»„ä»¶åŒ–å®ä¾‹åŒ–åå’Œé‡æ–°æ¸²æŸ“å‰è°ƒç”¨ï¼ˆç”Ÿæˆ VirtualDOM ä¹‹åï¼Œå®é™… DOM æŒ‚è½½ä¹‹å‰ï¼‰

  ```js
  1.æ— è®ºæ˜¯çˆ¶ç»„ä»¶çš„æ›´æ–°ã€props çš„å˜åŒ–æˆ–é€šè¿‡ setState æ›´æ–°ç»„ä»¶å†…éƒ¨çš„ Stateï¼Œå®ƒéƒ½ä¼šè¢«è°ƒç”¨ã€‚
  2.è¿”å›å€¼ï¼šè¯¥ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¿…é¡»æœ‰è¿”å›å€¼ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–° Stateï¼Œè‹¥è¿”å› null è¡¨æ˜æ–° props ä¸æ›´æ–° stateã€‚
  3.æ–°ç‰¹æ€§ï¼šå½“ç»„ä»¶å®ä¾‹åŒ–æ—¶ï¼Œè¯¥æ–¹æ³•æ›¿ä»£äº† componentWillMountï¼Œè€Œå½“æ¥æ”¶æ–°çš„ props æ—¶ï¼Œè¯¥æ–¹æ³•æ›¿ä»£äº† componentWillReceiveProps å’Œ componentWillUpdateã€‚
  é€‚ç”¨åœºæ™¯ï¼šè¡¨å•è·å–é»˜è®¤å€¼
  4.æ³¨æ„ï¼šgetDerivedStateFromProps æ˜¯ä¸€ä¸ªé™æ€å‡½æ•°ï¼Œä¸èƒ½ä½¿ç”¨this, ä¹Ÿå°±æ˜¯åªèƒ½ä½œä¸€äº›æ— å‰¯ä½œç”¨çš„æ“ä½œï¼Œå¦‚æœçˆ¶ç»„ä»¶å¯¼è‡´äº†ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œå³ä½¿å±æ€§æ²¡æœ‰æ›´æ–°ï¼Œè¿™ä¸€æ–¹æ³•ä¹Ÿä¼šè¢«è§¦å‘ï¼›
  è¯¥ç”Ÿå‘½å‘¨æœŸå‡½æ•°è¢«è®¾è®¡æˆé™æ€æ–¹æ³•çš„ç›®çš„æ˜¯ä¸ºäº†ä¿æŒè¯¥æ–¹æ³•çš„çº¯ç²¹ã€‚èƒ½å¤Ÿèµ·åˆ°é™åˆ¶å¼€å‘è€…æ— æ³•è®¿é—® this ä¹Ÿå°±æ˜¯å®ä¾‹çš„ä½œç”¨ï¼Œè¿™æ ·å°±ä¸èƒ½åœ¨é‡Œé¢è°ƒç”¨å®ä¾‹æ–¹æ³•æˆ–è€… setState ä»¥ç ´åè¯¥ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„åŠŸèƒ½ã€‚
  é€šè¿‡æ›´å…·çˆ¶ç»„ä»¶è¾“å…¥çš„ props æŒ‰éœ€æ›´æ–° stateï¼Œè¿™ç§ state å«åšè¡ç”Ÿ stateï¼Œè¿”å›çš„å¯¹è±¡å°±æ˜¯è¦å¢é‡æ›´æ–°çš„ stateï¼Œé™¤æ­¤ä¹‹å¤–ä¸åº”è¯¥åœ¨é‡Œé¢æ‰§è¡Œä»»ä½•æ“ä½œã€‚

  static getDerivedStateFromProps(nextProps, prevState) {
    if (nextProps.translateX !== prevState.translateX) {
      return {
        translateX: nextProps.translateX
      }
    }
    if (nextProps.data !== prevState.data){
      return {
        data: nextProps.data
      }
    }
    return null;
  }
  ```
* UNSAFE_componentWillMountï¼šé¢„è£…è½½å‡½æ•° componentWillMount å°†åœ¨ React v17 æ­£å¼åºŸå¼ƒï¼Œç”¨ UNSAFE_componentWillMount åˆ«åä»£æ›¿ã€‚

  ```js
  1.è§¦å‘æ—¶æœºï¼šåœ¨æ„é€ å‡½æ•°å’Œè£…è½½ç»„ä»¶ï¼ˆå°† DOM æ ‘æ¸²æŸ“åˆ°æµè§ˆå™¨ä¸­ï¼‰ä¹‹é—´è§¦å‘ã€‚è£…è½½ç»„ä»¶åå°†æ‰§è¡Œ render æ¸²æŸ“å‡½æ•°ã€‚å› æ­¤åœ¨æ­¤ç”Ÿå‘½å‘¨æœŸå‡½æ•°é‡Œä½¿ç”¨ setState åŒæ­¥è®¾ç½®ç»„ä»¶å†…éƒ¨çŠ¶æ€ state å°†ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚
  2.æ³¨æ„ï¼šé¿å…åœ¨è¯¥æ–¹æ³•ä¸­å¼•å…¥ä»»ä½•çš„å‰¯ä½œç”¨ï¼ˆEffectsï¼‰æˆ–è®¢é˜…ï¼ˆSubscriptionï¼‰ã€‚å¯¹äºè¿™äº›ä½¿ç”¨åœºæ™¯ï¼Œå»ºè®®æå‰åˆ°æ„é€ å‡½æ•°ä¸­
  ```
* renderï¼šç¬¬ä¸€æ¬¡ä»¥åŠä¹‹åç»„ä»¶å‘ç”Ÿæ›´æ–°ï¼Œéƒ½ä¼šæ‰§è¡Œrenderï¼Œä¸€ä¸ªä»…ä»…ç”¨äºæ¸²æŸ“çš„**çº¯å‡½æ•°**ï¼Œè¿”å›å€¼å®Œå…¨å–å†³äº state å’Œ propsï¼Œè€Œç”Ÿæˆè™šæ‹Ÿ DOM æ ‘è¿›è¡Œå¯¹æ¯”æ˜¯åœ¨ render å‡½æ•°æ‰§è¡Œäº†ä¹‹åè¿›è¡Œ

  ```js
  1.classç»„ä»¶ä¸­å”¯ä¸€å¿…é¡»å®ç°çš„æ–¹æ³•ï¼Œç”¨äºæ¸²æŸ“ DOM, render()æ–¹æ³•å¿…é¡»æœ‰è¿”å›å€¼ï¼Œè¿”å› null æˆ– false è¡¨ç¤ºä¸æ¸²æŸ“ä»»ä½• DOM å…ƒç´ ã€‚
  2.ä¸€ä¸ªä»…ä»…ç”¨äºæ¸²æŸ“çš„**çº¯å‡½æ•°**ã€‚æ­¤æ¸²æŸ“å‡½æ•°å¹¶ä¸åšå®é™…çš„æ¸²æŸ“åŠ¨ä½œï¼ˆæ¸²æŸ“åˆ° DOM æ ‘ï¼‰ï¼Œå®ƒè¿”å›ä¸€ä¸ª JSX çš„æè¿°å¯¹è±¡ï¼ˆåŠç»„ä»¶å®ä¾‹ï¼‰ï¼Œä½•æ—¶è¿›è¡ŒçœŸæ­£çš„æ¸²æŸ“æ˜¯æœ‰ React åº“å†³å®šã€‚
  3.åœ¨ç»„ä»¶ åˆå§‹åŒ– å’Œ propsæˆ–è€…stateå‘ç”Ÿå˜åŒ–æ—¶å€™è§¦å‘
  ```
* componentDidMountï¼šåœ¨ç»„ä»¶æŒ‚è½½å®Œæˆä¹‹å (æ’å…¥DOMæ ‘å) ç«‹å³è°ƒç”¨

  ```js
  1.è§¦å‘æ—¶æœºï¼šç»„ä»¶å®Œå…¨æŒ‚è½½åˆ°ç½‘é¡µä¸Šåè§¦å‘ 
  ä½¿ç”¨åœºæ™¯ï¼š
  å‘é€ç½‘ç»œè¯·æ±‚ï¼›
  ä»»ä½•ä¾èµ–äº DOM çš„åˆå§‹åŒ–æ“ä½œï¼›
  æ·»åŠ äº‹ä»¶ç›‘å¬ï¼›å¦‚æœä½¿ç”¨äº† Redux ä¹‹ç±»çš„æ•°æ®ç®¡ç†å·¥å…·ï¼Œä¹Ÿèƒ½è§¦å‘ action å¤„ç†æ•°æ®å˜åŒ–é€»è¾‘ã€‚
  æ­¤é’©å­å‡½æ•°ä¸­å…è®¸ä½¿ç”¨ setState æ”¹å˜ç»„ä»¶å†… Stateã€‚
  æ³¨æ„ï¼šè¯¥ç”Ÿå‘½å‘¨æœŸå‡½æ•°åœ¨è¿›è¡ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶ä¸ä¼šè§¦å‘ï¼ˆä»…å®¢æˆ·ç«¯æœ‰æ•ˆï¼‰ã€‚
  ```

### æ›´æ–°é˜¶æ®µ

ã€€ã€€å±æ€§ï¼ˆPropsï¼‰æˆ–çŠ¶æ€ï¼ˆStateï¼‰çš„æ”¹å˜ä¼šè§¦å‘ä¸€æ¬¡ç»„ä»¶çš„æ›´æ–°ï¼Œä½†æ˜¯ç»„ä»¶æ˜¯å¦ä¼šé‡æ–°æ¸²æŸ“ï¼Œè¿™å–å†³äº shouldComponentUpdate

* shouldComponentUpdateï¼šåœ¨ç»„ä»¶æ›´æ–°ä¹‹å‰è°ƒç”¨ï¼Œå¯ä»¥æ§åˆ¶ç»„ä»¶æ˜¯å¦è¿›è¡Œæ›´æ–°ï¼Œ è¿”å›trueæ—¶ç»„ä»¶æ›´æ–°ï¼Œ è¿”å›falseåˆ™ä¸æ›´æ–° shouldComponentUpdate(nextProps, nextState)

  ```js
  1.å½“propsæˆ–stateå‘ç”Ÿå˜åŒ–ï¼Œåœ¨é‡æ–°æ¸²æŸ“æ‰§è¡Œä¹‹å‰ï¼Œç¬¬ä¸€ä¸ªæ˜¯å³å°†æ›´æ–°çš„ props å€¼ï¼Œç¬¬äºŒä¸ªæ˜¯å³å°†è·Ÿæ–°åçš„ state å€¼ï¼Œå¯ä»¥æ ¹æ®æ›´æ–°å‰åçš„ props æˆ– state æ¥æ¯”è¾ƒåŠ ä¸€äº›é™åˆ¶æ¡ä»¶ï¼Œå†³å®šæ˜¯å¦æ›´æ–°ï¼Œè¿›è¡Œæ€§èƒ½ä¼˜åŒ–
  2.å½“è¯¥æ–¹æ³•è¿”å›çš„å¸ƒå°”å€¼ false å‘ŠçŸ¥ React æ— é¡»é‡æ–°æ¸²æŸ“æ—¶ï¼Œrenderã€UNSAFE_componentWillUpdate å’Œ componentDidUpdate ç­‰ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°éƒ½ä¸ä¼šè¢«è§¦å‘ã€‚
  3.æ­¤é’©å­å‡½æ•°åœ¨åˆå§‹åŒ–æ¸²æŸ“å’Œä½¿ç”¨äº† forceUpdate æ–¹æ³•çš„æƒ…å†µä¸‹ä¸ä¼šè¢«è§¦å‘ï¼Œä½¿ç”¨ forceUpdate ä¼šå¼ºåˆ¶æ›´æ–°
  4.è¯·å‹¿åœ¨æ­¤å‡½æ•°ä¸­ä½¿ç”¨ setState æ–¹æ³•ï¼Œä¼šå¯¼è‡´å¾ªç¯è°ƒç”¨ã€‚
  ```
* getSnapshotBeforeUpdateï¼šä¿å­˜çŠ¶æ€å¿«ç…§ã€‚è¯¥ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¼šåœ¨ç»„ä»¶å³å°†æŒ‚è½½æ—¶è§¦å‘ï¼Œå®ƒçš„è§¦å‘åœ¨ render æ¸²æŸ“å‡½æ•°ä¹‹åã€‚

  ```js
  ç”±æ­¤å¯è§ï¼Œrender å‡½æ•°å¹¶æ²¡æœ‰å®ŒæˆæŒ‚è½½æ“ä½œï¼Œè€Œæ˜¯è¿›è¡Œæ„å»ºæŠ½è±¡ UIï¼ˆä¹Ÿå°±æ˜¯ Virtual DOMï¼‰çš„å·¥ä½œã€‚è¯¥ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ‰§è¡Œå®Œæ¯•åå°±ä¼šç«‹å³è§¦å‘ componentDidUpdate ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚
  è¯¥ç”Ÿå‘½å‘¨æœŸå‡½æ•°èƒ½è®©ä½ æ•è·æŸäº›ä» DOM ä¸­æ‰èƒ½è·å–çš„ï¼ˆå¯èƒ½ä¼šå˜æ›´çš„ä¾‹å¦‚æ»šåŠ¨ä½ç½®ï¼‰ï¼Œæ­¤ç”Ÿå‘½å‘¨æœŸè¿”å›çš„ä»»ä½•å€¼éƒ½ä¼šä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ç»™ componentDidUpdate()ã€‚å¦‚ä¸éœ€è¦ä¼ é€’ä»»ä½•å€¼ï¼Œé‚£ä¹ˆè¯·è¿”å› nullã€‚
  getSnapshotBeforeUpdate(prevProps, prevState) {
      console.log('#enter getSnapshotBeforeUpdate');
      return 'foo';
  }
  componentDidUpdate(prevProps, prevState, snapshot) {
      console.log('#enter componentDidUpdate snapshot = ', snapshot);
  }

  ```
* componentDidUpdateï¼šç»„ä»¶æ¯æ¬¡é‡æ–°æ¸²æŸ“åä¼šè§¦å‘ componentDidUpdate ï¼› ä½†æ˜¯åªæœ‰åœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“ï¼ˆå³åˆå§‹åŒ–ï¼‰æ—¶è§¦å‘çš„æ˜¯ componentDidMount é’©å­å‡½æ•°ï¼Œåˆå§‹åŒ–æ¸²æŸ“åcomponentDidMount ä¸ä¼šå†è¢«è§¦å‘ã€‚

  ```js
  1.åœ¨ componentDidUpdate ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­è°ƒç”¨ setState æ–¹æ³•æ—¶ï¼Œç¡®å®éœ€è¦åŠ ä¸Šæ¡ä»¶åˆ¤æ–­ï¼Œä»¥é¿å…æ­»å¾ªç¯çš„å‘ç”Ÿã€‚
  2.é€šè¿‡åˆ¤æ–­ prevPropsã€prevState å’Œ this.state ä¹‹é—´çš„æ•°æ®å˜åŒ–ï¼Œæ¥åˆ¤æ–­æ˜¯å¦æ‰§è¡Œç›¸å…³çš„ state å˜æ›´é€»è¾‘ï¼Œè¿™ä½¿å¾—å°½ç®¡åœ¨ componentDidUpdate ä¸­è°ƒç”¨äº† setState è¿›è¡Œå†æ›´æ–°ï¼Œå¦‚æœæ¡ä»¶ä¸æˆç«‹stateå°±ä¸ä¼šè¿›è¡Œæ›´æ–°ï¼Œä»è€Œé¿å…äº†æ­»å¾ªç¯çš„å‘ç”Ÿã€‚
  ç›¸æ¯”è£…è½½é˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ›´æ–°é˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä½¿ç”¨çš„ç›¸å¯¹æ¥è¯´è¦å°‘ä¸€äº›ã€‚
  å¸¸ç”¨çš„æ˜¯getDerivedStateFromPropsã€shouldComponentUpdateï¼Œ å‰è€…ç»å¸¸ç”¨äºæ ¹æ®æ–° props çš„æ•°æ®å»è®¾ç½®ç»„ä»¶çš„ Stateï¼Œè€Œåè€…åˆ™æ˜¯å¸¸ç”¨äºä¼˜åŒ–ï¼Œé¿å…ä¸å¿…è¦çš„æ¸²æŸ“ã€‚
  componentDidUpdate(prevProps){
      if (this.props.id !== prevProps.id){
          this.fetchData(this.props.id);
      }
  }

  ```

### å¸è½½é˜¶æ®µ

* componentWillUnmountï¼šåœ¨ç»„ä»¶å¸è½½å’Œé”€æ¯ä¹‹å‰è§¦å‘ã€‚å¯ä»¥åˆ©ç”¨è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•è¿›è¡Œäº‹ä»¶çš„è§£ç»‘ã€‚

  ```js
  ç”¨äºç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼›å–æ¶ˆç½‘ç»œè¯·æ±‚ï¼›å–æ¶ˆå®šæ—¶å™¨ï¼›è§£ç»‘ DOM äº‹ä»¶ã€‚ åœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨ setState ä¸ä¼šè§¦å‘ renderï¼Œå› ä¸ºæ‰€æœ‰çš„æ›´æ–°é˜Ÿåˆ—ï¼Œæ›´æ–°çŠ¶æ€éƒ½è¢«é‡ç½®ä¸º nullã€‚
  ```

### ç»„ä»¶é—´çš„å‘¨æœŸé¡ºåº

ã€€ã€€å½“å­ç»„ä»¶è‡ªèº«çŠ¶æ€æ”¹å˜æ—¶ï¼Œä¸ä¼šå¯¹çˆ¶ç»„ä»¶äº§ç”Ÿå‰¯ä½œç”¨çš„æƒ…å†µä¸‹ï¼Œçˆ¶ç»„ä»¶ä¸ä¼šè¿›è¡Œæ›´æ–°ï¼Œå³ä¸ä¼šè§¦å‘çˆ¶ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ

ã€€ã€€å½“çˆ¶ç»„ä»¶ä¸­çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼ˆåŒ…æ‹¬å­ç»„ä»¶çš„æŒ‚è½½ä»¥åŠå¸è½½ï¼‰æ—¶ï¼Œä¼šè§¦å‘è‡ªèº«å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸä»¥åŠå­ç»„ä»¶çš„æ›´æ–°

* çˆ¶å­ç»„ä»¶åˆå§‹åŒ–

  ```js
  Parent ç»„ä»¶ï¼š constructor()
  Parent ç»„ä»¶ï¼š getDerivedStateFromProps()
  Parent ç»„ä»¶ï¼š render()
  Child ç»„ä»¶ï¼š constructor()
  Child ç»„ä»¶ï¼š getDerivedStateFromProps()
  Child ç»„ä»¶ï¼š render()
  Child ç»„ä»¶ï¼š componentDidMount()
  Parent ç»„ä»¶ï¼š componentDidMount()

  å½“æ‰§è¡Œrenderå­ç»„ä»¶çš„æ—¶å€™ï¼Œæ‰ä¼šè¿›å…¥å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå­ç»„ä»¶çš„å‘¨æœŸç»“æŸåï¼Œå†å›åˆ°ä¸Šçº§çš„å‘¨æœŸã€‚
  ```
* æ”¹å˜å­ç»„ä»¶è‡ªèº«çŠ¶æ€

  ```js
  Child ç»„ä»¶ï¼š getDerivedStateFromProps()
  Child ç»„ä»¶ï¼š shouldComponentUpdate()
  Child ç»„ä»¶ï¼š render()
  Child ç»„ä»¶ï¼š getSnapshotBeforeUpdate()
  Child ç»„ä»¶ï¼š componentDidUpdate()

  ```
* ä¿®æ”¹çˆ¶ç»„ä»¶ä¼ å…¥ç»™å­ç»„ä»¶çš„ props å½“çˆ¶ç»„ä»¶ä¿®æ”¹ä¼ é€’çš„ props å€¼æ—¶ï¼Œä¼šè§¦å‘çˆ¶å­ç»„ä»¶çš„æ›´æ–°

  ```js
  Parent ç»„ä»¶ï¼š getDerivedStateFromProps()
  Parent ç»„ä»¶ï¼š shouldComponentUpdate()
  Parent ç»„ä»¶ï¼š render()
  Child ç»„ä»¶ï¼š getDerivedStateFromProps()
  Child ç»„ä»¶ï¼š shouldComponentUpdate()
  Child ç»„ä»¶ï¼š render()
  Child ç»„ä»¶ï¼š getSnapshotBeforeUpdate()
  Parent ç»„ä»¶ï¼š getSnapshotBeforeUpdate()
  Child ç»„ä»¶ï¼š componentDidUpdate()
  Parent ç»„ä»¶ï¼š componentDidUpdate()
  ```
* åªä¿®æ”¹çˆ¶ç»„ä»¶çš„å€¼ å½“çˆ¶ç»„ä»¶çš„å€¼è¢«ä¿®æ”¹æ—¶ï¼Œä¼šè§¦å‘çˆ¶ç»„ä»¶çš„ render() æ–¹æ³•é‡æ–°æ¸²æŸ“ï¼Œå¹¶é€’å½’åœ° r-render å­ç»„ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šä¾æ¬¡è§¦å‘æ‰€æœ‰å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼š

  ```js
  Parent ç»„ä»¶ï¼š getDerivedStateFromProps()
  Parent ç»„ä»¶ï¼š shouldComponentUpdate()
  Parent ç»„ä»¶ï¼š render()
  Child ç»„ä»¶ï¼š getDerivedStateFromProps()
  Child ç»„ä»¶ï¼š shouldComponentUpdate()
  Child ç»„ä»¶ï¼š render()
  Child ç»„ä»¶ï¼š getSnapshotBeforeUpdate()
  Parent ç»„ä»¶ï¼š getSnapshotBeforeUpdate()
  Child ç»„ä»¶ï¼š componentDidUpdate()
  Parent ç»„ä»¶ï¼š componentDidUpdate()

  ```
* å­ç»„ä»¶ä¿®æ”¹è‡ªèº«state

  ```js
  å­ç»„ä»¶ getDerivedStateFromProps
  å­ç»„ä»¶ shouldComponentUpdate
  å­ç»„ä»¶ render
  å­ç»„ä»¶ getSnapShotBeforeUpdate
  å­ç»„ä»¶ componentDidUpdate
  ```
* å¸è½½å­ç»„ä»¶

  ```js
  Parent ç»„ä»¶ï¼š getDerivedStateFromProps()
  Parent ç»„ä»¶ï¼š shouldComponentUpdate()
  Parent ç»„ä»¶ï¼š render()
  Parent ç»„ä»¶ï¼š getSnapshotBeforeUpdate()
  Child ç»„ä»¶ï¼š componentWillUnmount()
  Parent ç»„ä»¶ï¼š componentDidUpdate()
  ```

## æ’æ§½

### children

ã€€ã€€çˆ¶ç»„ä»¶å¯ä»¥ç›´æ¥å‘å­ç»„ä»¶ä¸­æ’å…¥å†…å®¹ï¼Œæ­¤æ—¶åœ¨å­ç»„ä»¶ä¸­å¯ä»¥åœ¨**this.props.children**è·å–åˆ°æ’å…¥åˆ°å…¶ä¸­ä¼ é€’çš„å…ƒç´ ã€‚

1. å¦‚æœæ’å…¥äº†å¤šä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆthis.props.childrenæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ­¤æ—¶å¯é€šè¿‡ç´¢å¼•è®¿é—®åˆ°å¯¹åº”ä½ç½®çš„å…ƒç´ 

2. å¦‚æœæ’å…¥äº†å•ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆthis.props.childrenå³è¯¥å…ƒç´ ï¼ˆ**å°±ä¸æ˜¯ä¸€ä¸ªæ•°ç»„äº†**ï¼‰

* å­ç»„ä»¶

  ```js
  å­ç»„ä»¶é€šè¿‡this.props.children è·å–çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„æ ‡ç­¾
  import React, { Component } from 'react'
  import PropTypes from "prop-types"

  export class NavBar extends Component {
    render() {
      const { children } = this.props
      return (
        <div>
          <div>{ children[0] }</div>
          <div>{ children[1] }</div>
          <div>{ children[2] }</div>
        </div>
      )
    }
  }

  NavBar.propTypes = {
    children: PropTypes.array//è¡¨ç¤ºchildrenæ˜¯æ•°ç»„å½¢å¼ï¼Œéœ€è¦çˆ¶ç»„ä»¶ä¼ é€’å¤šä¸ªå†…å®¹è¿›æ¥
    children: PropTypes.element//è¡¨ç¤ºchildrenæ˜¯ä¸€ä¸ªå…ƒç´ ï¼Œçˆ¶ç»„ä»¶åªèƒ½ä¼ é€’ä¸€ä¸ªå†…å®¹è¿›æ¥ï¼Œè¿™æ ·çš„è¯ï¼Œthis.props.children å°±æ˜¯æŒ‡è¯¥åŸç”Ÿæœ¬èº«äº†
  }

  export default NavBar
  ```
* çˆ¶ç»„ä»¶

  ```js
  import React, { Component } from 'react'
  import NavBar from './nav-bar'

  export class App extends Component {
    render() {
      return (
        <div>
          <NavBar>
            <button>æŒ‰é’®</button>
            <h2>å“ˆå“ˆå“ˆ</h2>
            <i>æ–œä½“æ–‡æœ¬</i>
          </NavBar>
        </div>
      )
    }
  }

  export default App

  ```

### props

ã€€ã€€ä½¿ç”¨childrenå®ç°æ’æ§½æˆ–è®¸æ˜¯æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯ä½¿ç”¨ç´¢å¼•è·å–ä¼ å…¥è¿›æ¥çš„å…ƒç´ å®¹æ˜“å‡ºé”™ï¼Œéœ€è¦æ˜ç¡®é¡ºåºï¼Œæ¶‰åŠåˆ°ç´¢å¼•å˜åŠ¨å°±æ¯”è¾ƒéº»çƒ¦

ã€€ã€€**åœ¨çˆ¶ç»„ä»¶ä¸­ä¸ä»…å¯ä»¥ä½¿ç”¨propsæ¥å‘å­ç»„ä»¶ä¼ é€’æ•°æ®ã€å›è°ƒå‡½æ•°å¤–ï¼Œè¿˜å¯ä»¥ä¼ é€’å…ƒç´ **

* çˆ¶ç»„ä»¶

  ```js
  import React, { Component } from 'react'
  import NavBar from './nav-bar'

  export class App extends Component {
    render() {
      const btn = <button>æŒ‰é’®</button>
      return (
        <div>
          <NavBar
            leftSlot={btn}
            centerSlot={<h2>å“ˆå“ˆå“ˆ</h2>}
            rightSlot={<i>123</i>}
          />
        </div>
      )
    }
  }
  export default App
  ```
* å­ç»„ä»¶

  ```js
  import React, { Component } from 'react'
  export class NavBarTwo extends Component {
    render() {
      const { leftSlot, centerSlot, rightSlot } = this.props

      return (
        <div className='nav-bar'>
          <div className="left">{leftSlot}</div>
          <div className="center">{centerSlot}</div>
          <div className="right">{rightSlot}</div>
        </div>
      )
    }
  }
  export default NavBarTwo
  ```

## hooks

ã€€ã€€reactä¸­ï¼šHook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚

ã€€ã€€Hookåªèƒ½åœ¨å‡½æ•°å¼ç»„ä»¶æˆ–è€…è‡ªå®šä¹‰hookä¸­ä½¿ç”¨ï¼Œä¸èƒ½åœ¨ç±»å¼ç»„ä»¶ä¸­ä½¿ç”¨

ã€€ã€€Hookåªèƒ½åœ¨é¡¶å±‚è°ƒç”¨ï¼Œä¸èƒ½åœ¨å¾ªç¯ã€æ¡ä»¶è¯­å¥æˆ–åµŒå¥—å‡½æ•°ä¸­ä½¿ç”¨ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´é¢„æ–™ä¹‹å¤–çš„ bug

### useState

* ä½œç”¨ï¼šè®©å‡½æ•°ç»„ä»¶å…·æœ‰ä¿®æ”¹stateçš„ èƒ½åŠ›ï¼Œå› ä¸ºåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­æ²¡æœ‰ thisï¼ŒReact ä¼šåœ¨é‡å¤æ¸²æŸ“æ—¶ä¿ç•™è¿™ä¸ª stateï¼Œè€Œ useState å¯ä»¥è®©ä½ åœ¨å‡½æ•°ç»„ä»¶ä¸­ç®¡ç†çŠ¶æ€ã€‚
* ä½¿ç”¨

  ```js
  import React, { useState } from 'react';

  function Example() {
    // å£°æ˜ä¸€ä¸ªå« count çš„ state å˜é‡ useState(0) ä¼ å‚ 0 ä¸ºè®¾ç½®çš„åˆå§‹å€¼
    const [count, setCount] = useState(0); //[] æ•°ç»„è§£æ„  å–åˆ°æ•°ç»„ä¸­å¯¹åº”ä½ç½®çš„å€¼ èµ‹ç»™ç›¸åº”å˜é‡
    // å£°æ˜å¤šä¸ª state å˜é‡ï¼Œç»™ä¸åŒçš„ state å˜é‡å–ä¸åŒçš„åç§°  state å˜é‡å¯ä»¥å¾ˆå¥½åœ°å­˜å‚¨å¯¹è±¡å’Œæ•°ç»„
    const [todos, setTodos] = useState([{ text: 'å­¦ä¹  Hook' }]);
    return (
      <div>
      	<!-- åœ¨å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ count -->
        <p>You clicked {count} times</p>
        <!-- æ›´æ–°state  setCount å’Œ count å˜é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ this -->
        <button onClick={() => setCount(count + 1)}>
          Click me
        </button>
      </div>
    );
  }
  ```

### useEffect

* ä½œç”¨ï¼šç»™å‡½æ•°å¼ç»„ä»¶æä¾›æ“ä½œå‰¯ä½œç”¨çš„èƒ½åŠ›ï¼Œåœ¨renderä¹‹åæ‰§è¡Œã€‚è°ƒç”¨ `useEffect`â€‹æ—¶ï¼Œå°±æ˜¯å‘Šè¯‰reactåœ¨å®Œæˆå¯¹domçš„æ›´æ”¹åè¿è¡Œè®¾ç½®å¥½çš„å‰¯ä½œç”¨å‡½æ•°
* ä½¿ç”¨

  ```js
  import React, { useState, useEffect } from 'react';
  function Example() {
    const [count, setCount] = useState(0);
    useEffect(
      () => {
        // åœ¨å‡½æ•°ä½“å†…éƒ¨æ‰§è¡Œçš„æ“ä½œ ç­‰ä»·äº componentDidMount  & componentDidUpdate
        // ä½¿ç”¨æµè§ˆå™¨çš„ API æ›´æ–°é¡µé¢æ ‡é¢˜     		
        document.title = `You clicked ${count} times`;  
        // å‡½æ•° return æ—¶ç­‰ä»·äº componentWillUnmount å¦‚è§£ç»‘äº‹ä»¶ 
        return () => {
           // do something...
        };
      },
      // ç›‘å¬æ•°æ®ï¼Œå½“ä¾èµ–çš„å€¼å‘ç”Ÿå˜æ›´æ—¶ï¼Œæ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°
      [ xxxï¼Œobj.xxx ]
    );
    return (
      <div>
        <p>You clicked {count} times</p>
        <button onClick={() => setCount(count + 1)}>
          Click me
        </button>
      </div>
    );
  }
  ```
* æ³¨æ„ç‚¹

  ```js
  1.å‚æ•°æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯éœ€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œä¸€ä¸ªä¾èµ–æ•°ç»„
  2.ä¾èµ–æ•°ç»„åœ¨æŒ‡å®šçš„çŠ¶æ€å˜åŒ–æ—¶å€™ï¼Œé‡æ–°æ‰§è¡Œå›è°ƒå‡½æ•°
  3.ä¾èµ–æ•°ç»„ä¸º[]ï¼Œè¡¨ç¤ºä¸ä¼šå› ä¸ºçŠ¶æ€æ”¹å˜è€Œæ‰§è¡Œå›è°ƒï¼Œåªä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œï¼Œç›¸å¯¹äºç”Ÿå‘½å‘¨æœŸä¸­çš„ componentDdidMount
  4.å‡½æ•°ç»„ä»¶æ¯æ¸²æŸ“ä¸€æ¬¡ï¼Œè¯¥å‡½æ•°å°±æ‰§è¡Œä¸€æ¬¡
  5.ç¬¬ä¸€ä¸ªå‚æ•°çš„å›è°ƒå‡½æ•°æœ‰è¿”å›å€¼ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨ç»„ä»¶è¢«å¸è½½å‰æ‰§è¡Œï¼Œç”¨äºæ¸…é™¤ä¹‹å‰æ‰§è¡Œçš„å‰¯ä½œç”¨æ“ä½œã€‚
  è¿™æ„å‘³ç€æ¯æ¬¡æ‰§è¡ŒuseEffectæ—¶ï¼Œéƒ½ä¼šå…ˆæ¸…é™¤ä¹‹å‰çš„å‰¯ä½œç”¨æ“ä½œï¼Œç„¶åå†æ‰§è¡Œæ–°çš„å‰¯ä½œç”¨æ“ä½œï¼Œå¦‚æœç»„ä»¶å¤šæ¬¡æ¸²æŸ“ï¼Œåˆ™åœ¨æ‰§è¡Œä¸‹ä¸€ä¸ª useEffect ä¹‹å‰ï¼Œä¸Šä¸€ä¸ª useEffect å°±å·²è¢«æ¸…é™¤+

  //å› ä¸ºç»„ä»¶çš„æ¯æ¬¡æ¸²æŸ“ï¼Œéƒ½ä¼šæ‰§è¡Œè®¾ç½®å¥½çš„å›è°ƒï¼Œæ‰€ä»¥è¦è®¾ç½®å¥½è¿”å›å‡½æ•°ç”¨äºæ¸…ç©ºå‰¯ä½œç”¨ï¼Œé¿å…ä¸€äº›åçš„å½±å“
  useEffect(()=>{
    // å³é”®ç›‘å¬äº‹ä»¶
    document.addEventListener('contextmenu', handleContext);
    return ()=> {
      // ç§»é™¤äº‹ä»¶ç›‘å¬
      document.removeEventListener('contextmenu', handleContext)
    }
  })

  ```
* å¸¸è§ç”¨é€”

  ```js
  æ•°æ®è·å–ï¼šä½¿ç”¨useEffectå¯ä»¥åœ¨ç»„ä»¶æ¸²æŸ“åå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œè·å–æ•°æ®å¹¶æ›´æ–°ç»„ä»¶çŠ¶æ€ã€‚
  è®¢é˜…æ•°æ®æºï¼šä½¿ç”¨useEffectå¯ä»¥åœ¨ç»„ä»¶æ¸²æŸ“åè®¢é˜…æ•°æ®æºï¼Œå¹¶åœ¨æ•°æ®æ›´æ–°æ—¶æ›´æ–°ç»„ä»¶çŠ¶æ€ã€‚
  æ‰‹åŠ¨ä¿®æ”¹DOMï¼šä½¿ç”¨useEffectå¯ä»¥åœ¨ç»„ä»¶æ¸²æŸ“åæ‰‹åŠ¨ä¿®æ”¹DOMï¼Œä¾‹å¦‚æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ–°å…ƒç´ ã€‚
  ç»‘å®šç›‘å¬äº‹ä»¶ï¼šåœ¨ useEffect ä¸­ç»‘å®šäº‹ä»¶çš„ç›‘å¬æˆ–è®¢é˜…ï¼Œå¹¶åœ¨ return æ—¶è§£é™¤å¯¹äº‹ä»¶çš„ç»‘å®šã€‚

  ç»„ä»¶åˆå§‹åŒ–ï¼šä½¿ç”¨useEffectå¯ä»¥åœ¨ç»„ä»¶åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€äº›é€»è¾‘ï¼Œä¾‹å¦‚è®¾ç½®åˆå§‹çŠ¶æ€ã€åˆå§‹åŒ–æ•°æ®ç­‰ã€‚
  ç»„ä»¶å¸è½½ï¼šä½¿ç”¨useEffectå¯ä»¥åœ¨ç»„ä»¶å¸è½½æ—¶æ‰§è¡Œä¸€äº›æ¸…ç†é€»è¾‘ï¼Œä¾‹å¦‚å–æ¶ˆè®¢é˜…ã€æ¸…é™¤å®šæ—¶å™¨ç­‰ã€‚
  ç›‘å¬çŠ¶æ€å˜åŒ–ï¼šä½¿ç”¨useEffectå¯ä»¥ç›‘å¬ç»„ä»¶çŠ¶æ€çš„å˜åŒ–ï¼Œå¹¶åœ¨å˜åŒ–æ—¶æ‰§è¡Œä¸€äº›é€»è¾‘ï¼Œä¾‹å¦‚æ›´æ–°DOMã€è§¦å‘åŠ¨ç”»ç­‰ã€‚
  ```

### useContext

* ä½œç”¨ï¼šå®ç°è·¨ç»„ä»¶é—´çš„æ•°æ®ä¼ è¾“ï¼Œå°±æ˜¯ç±»ç»„ä»¶contextä¸­çš„æ•°æ®æ¶ˆè´¹è€…ã€‚
* æ³¨æ„ç‚¹ï¼š`useContext â€‹`â€‹çš„å‚æ•°å¿…é¡»æ˜¯ `context â€‹`â€‹å¯¹è±¡æœ¬èº«ã€‚
* ä½¿ç”¨ï¼šä¼ å…¥ `context â€‹`â€‹â€‹å¯¹è±¡æœ¬èº«ï¼Œæ¥è·å–çˆ¶ç»„ä»¶æä¾›çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä¿¡æ¯

  ```js
  1.åˆ›å»ºcontextå¯¹è±¡
  import { createContext } from 'react';
  export const MyContext = createContext();
  2.åœ¨çˆ¶ç»„ä»¶ä¸­æä¾›ä¾èµ–ä¿¡æ¯
  export default calss App extend Compontend {
    render(){
      return (
         <MyContext.Provider value={
            ... éœ€è¦æä¾›çš„å±æ€§
          }>
            <Son></Son>//å­ç»„ä»¶éœ€è¦è¢«åŒ…è£¹
         <MyContext.provider>
      )
    }
  }

  3.å­æ¥æ”¶çˆ¶ç»„ä»¶ä¼ æ¥çš„context
  import MyContext  from "xxx"
  import { useContext } from "react"
  export default function Son(){
    const context = useContext(useContext)//context å°±æ˜¯çˆ¶ç»„ä»¶æä¾›çš„æ•°æ®å¯¹è±¡
    return <div>...</div>
  }
  ```

### useReducer

* ä½œç”¨ï¼šç”¨äºç®¡ç†ç»„ä»¶ä¸­çš„çŠ¶æ€ã€‚ä¸useStateä¸åŒï¼ŒuseReducerå¯ä»¥æ›´å¥½çš„å¤„ç†å¤æ‚çš„çŠ¶æ€é€»è¾‘ï¼Œå°¤å…¶æ˜¯éœ€è¦å¤šä¸ªçŠ¶æ€ç›¸äº’ä½œç”¨æ—¶ï¼Œå¯ä»¥ç®€å•çš„ç†è§£æˆæ˜¯ å°å·ç‰ˆçš„vuexï¼Œä¸æ˜¯å…¨å±€æ€§çš„ï¼Œä½†æ˜¯å¯ä»¥åœ¨å¤šä¸ªç»„ä»¶ä¸­ä½¿ç”¨ã€‚
* reducerå’ŒreduxåŒºåˆ«

  ```js
  1.reducerç”¨äºå•ä¸ªç»„ä»¶çš„çŠ¶æ€ç®¡ç†ï¼Œé€‚åˆå¤æ‚çš„stateå˜åŒ–
  2.reduxæ˜¯å…¨å±€çš„çŠ¶æ€ç®¡ç†å·¥å…·
  3.reduceråœ¨ç»„ä»¶é—´çš„é€šä¿¡ä½¿ç”¨çš„è¿˜æ˜¯ props
  ```
* ä½¿ç”¨ï¼šreducer è¿”å›å€¼å’Œå½“å‰çš„stateç›¸åŒï¼Œreactä¼šè·³è¿‡å­ç»„ä»¶çš„æ¸²æŸ“åŠå‰¯ä½œç”¨çš„æ‰§è¡Œ

  ```js
  1.å‚æ•°1ï¼šä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ç¬¬ä¸€ä¸ªå½¢å‚æ˜¯stateï¼Œç¬¬äºŒä¸ªå½¢å‚æ˜¯actionï¼Œè¡¨ç¤ºè¿”å›çš„dispathä¸­ä¼ é€’çš„å¯¹è±¡
  2.å‚æ•°2ï¼šé»˜è®¤çŠ¶æ€çš„å¯¹è±¡
  3.è¿”å›å€¼1ï¼šçŠ¶æ€state
  4.è¿”å›å€¼2ï¼šä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸ªå¯¹è±¡ï¼Œä¼šä¼ é€’ç»™acitonï¼Œåˆ©ç”¨å¯¹è±¡ä¸­çš„å˜é‡ä¸åŒï¼Œæ¥æ”¹å˜state
  5.reactä¼šç¡®ä¿ dispath å‡½æ•°çš„æ ‡è¯†æ˜¯ç¨³å®šçš„ï¼Œä¸ä¼šåœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“çš„æ—¶å€™æ”¹å˜
  6.reducer è¿”å›å€¼å’Œå½“å‰çš„stateç›¸åŒï¼ˆä½¿ç”¨Object.is æ¥æ¯”è¾ƒï¼‰ï¼Œreactä¼šè·³è¿‡å­ç»„ä»¶çš„æ¸²æŸ“åŠå‰¯ä½œç”¨çš„æ‰§è¡Œ

  æ¥æ”¶ (state,action)=>newState çš„ reducerï¼Œå¹¶è¿”å›å½“å‰çš„stateå’Œé…å¥—çš„dispathæ–¹æ³•ã€‚
  const [state, dispatch] = useReducer(reducer, initialArg, init);
  const initialState = {count: 0};
  function reducer(state, action) {
    switch (action.type) {
      case 'increment':
        return {count: state.count + 1};
      case 'decrement':
        return {count: state.count - 1};
      default:
        throw state //è¿™æ ·å¯ä»¥è·³è¿‡æ¸²æŸ“
    }
  }

  function Counter() {
    const [state, dispatch] = useReducer(reducer, initialState);
    return (
      <>
        Count: {state.count}
        <button onClick={() => dispatch({type: 'decrement'})}>-</button>
        <button onClick={() => dispatch({type: 'increment'})}>+</button>
      </>
    );
  }
  ```

### useContextå’ŒuseReducer

ã€€ã€€â€‹`useContext â€‹`â€‹å’Œ `useReducer â€‹`â€‹ç»å¸¸ç»“åˆåœ¨ä¸€èµ·è¿›è¡Œä½¿ç”¨ï¼Œç”¨äºå•ç»„ä»¶ä¸‹çš„çŠ¶æ€ç®¡ç†

ã€€ã€€â€‹`useContext â€‹`â€‹æ–¹ä¾¿ç®¡ç†çˆ¶ç»„ä»¶ä¼ é€’æ¥çš„`props`â€‹ï¼Œ`useReducer â€‹`â€‹æ–¹ä¾¿ç®¡ç†å¤æ‚çš„state

* çˆ¶ç»„ä»¶ï¼šæä¾›props

  ```js
  // App.tsx
  import './App.css';
  import React, { useContext, useReducer } from 'react'
  import Son from './pages/Son';
  const initState = {
    count: 1
  } // å®šä¹‰åˆå§‹åŒ–æ•°æ®
  export const Context = React.createContext<{
    state: typeof initState,
    dispatch: React.Dispatch<any>
  }>({
    state: initState,
    dispatch: () => { },
  })


  function App() {
    const reducer = (preState, action) => {
      let { type } = action;
      if (typeof action === 'function') {
        type = action()
      }

      switch (type) {
        case 'increment':
          return { count: preState.count + 1 };
        default:
          return preState;
      }
    } // å®šä¹‰reducer
    const [state, dispatch] = useReducer(reducer, initState) // æŠŠæ•°æ®ä¼ é€’ç»™reducer

    return (
      <Context.Provider value={{ state, dispatch }}>
        <div className="App">
          <div>è¿™æ˜¯ä¸€ä¸ªç»„ä»¶</div>
          <Son />
        </div>
      </Context.Provider>
    );
  }

  export default App;
  ```
* å­ç»„ä»¶ï¼šä½¿ç”¨ `useContext`â€‹æ–¹ä¾¿æ¥æ”¶æ•°æ®

  ```js
  // Son.tsx
  import React, { useContext } from 'react';
  import { Context } from '../App'
  const Son = () => {
    const context = useContext(Context)
    console.log(context);

    return (
      <div>
        è¿™æ˜¯å­ç»„ä»¶
        {context.state.count}
        <div onClick={() => context.dispatch({ type: 'increment' })}>å­ç»„ä»¶é‡Œç‚¹å‡»count + 1</div>
      </div>
    )
  }
  export default Son
  ```

### useMemo

* æ¦‚å¿µï¼šå¯¹ä¾èµ–çš„è®¡ç®—ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå¯ä»¥æé«˜ç»„ä»¶çš„æ€§èƒ½ï¼Œç±»ä¼¼vueä¸­çš„computed
* ä½¿ç”¨ï¼šå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªè®¡ç®—å‡½æ•°å’Œä¸€ä¸ªä¾èµ–é¡¹æ•°ç»„ã€‚

  ```js
  1.å½“ä¾èµ–é¡¹æ•°ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ªå€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒuseMemo å°†é‡æ–°è®¡ç®—è®¡ç®—å‡½æ•°ï¼Œå¹¶è¿”å›æ–°çš„ç»“æœã€‚å¦åˆ™ï¼Œå®ƒå°†è¿”å›ä¹‹å‰ç¼“å­˜çš„ç»“æœã€‚
  2.useMemo æ‹¥æœ‰æš‚å­˜èƒ½åŠ›ï¼Œç¼“å­˜ä¸Šä¸€æ¬¡çš„ç»“æœå¹¶æ¯”å¯¹ï¼Œè‹¥å€¼æœªå‘ç”Ÿå˜åŒ–åˆ™ä¸èµ‹å€¼ã€‚
  æ³¨æ„:ä¼ å…¥ useMemo çš„å‡½æ•°ä¼šåœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œã€‚æ‰€ä»¥ä¸è¦åœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨æ‰§è¡Œä¸æ¸²æŸ“æ— å…³çš„æ“ä½œã€‚å¦åˆ™åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶ useMemo éƒ½ä¼šè¿›è¡Œè®¡ç®—ã€‚
  import { useMemo } from "react"
  const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);
  ```

### useCallback

* æ¦‚å¿µï¼šç¼“å­˜å‡½æ•°ï¼Œå‡½æ•°å¼ç»„ä»¶ï¼Œåœ¨stateã€propsæ”¹å˜æ—¶éƒ½ä¼šæ¸²æŸ“ï¼Œä¸ºäº†é¿å…`function`â€‹çš„é‡å¤å®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨è¯¥hook
* ä½¿ç”¨ï¼šæŠŠå†…è”å›è°ƒå‡½æ•°åŠä¾èµ–é¡¹æ•°ç»„ä½œä¸ºå‚æ•°ä¼ å…¥ `useCallback`â€‹ï¼Œå®ƒå°†è¿”å›è¯¥å›è°ƒå‡½æ•°çš„**ç¼“å­˜ç‰ˆæœ¬**ï¼Œè¯¥å›è°ƒå‡½æ•°åªæœ‰åœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰ä¼šæ›´æ–°ã€‚

  ```js
  1.äº‹å®ä¸Šï¼ŒuseCallback å†…éƒ¨å®ç°å°±æ˜¯ä½¿ç”¨äº† useMemoï¼ŒuseCallback(fn, deps) ç›¸å½“äº useMemo(() => fn, deps)ï¼Œå®ƒä»¬éƒ½å¯ä»¥ç”¨æ¥ç¼“å­˜ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶åœ¨ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°åˆ›å»ºè¯¥å‡½æ•°ã€‚

  const memoizedCallback = useCallback(
    () => {
      doSomething(a, b);
    },
    [a, b],
  );
  ```

### useRef

* æ¦‚å¿µï¼šuseRef ç”¨äºåˆ›å»ºä¸€ä¸ªå¯å˜çš„ ref å¯¹è±¡ã€‚åŒæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ ref è®¿é—® DOMã€‚åªæœ‰currentä¸€ä¸ªå±æ€§
* ç‰¹ç‚¹ï¼š

  ```js
  1.useRef åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šè¿”å›åŒä¸€ä¸ª ref å¯¹è±¡ï¼Œå› æ­¤å®ƒå¯ä»¥ç”¨æ¥å­˜å‚¨ç»„ä»¶ä¸­çš„æŒä¹…åŒ–æ•°æ®ï¼Œè€Œä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚
  2.useRef ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¿”å›åŒä¸€ä¸ª ref å¯¹è±¡ã€‚
  3.è¿”å›ä¸€ä¸ªå¯å˜çš„ ref å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åªæœ‰ä¸ª current å±æ€§ï¼Œåˆå§‹å€¼ä¸ºä¼ å…¥çš„å‚æ•°( initialValue )
  4.å½“æ›´æ–° current å€¼æ—¶ä¸ä¼šå¼•å‘ç»„ä»¶é‡æ–°æ¸²æŸ“
  5.useRef ç±»ä¼¼äºç±»ç»„ä»¶çš„ this

  ```
* ä½¿ç”¨

  ```js
  function TextInputWithFocusButton() {
    const inputEl = useRef(null);
    const onButtonClick = () => {
      // `current` æŒ‡å‘å·²æŒ‚è½½åˆ° DOM ä¸Šçš„æ–‡æœ¬è¾“å…¥å…ƒç´ 
      // é€šè¿‡ ref è·å– dom å…ƒç´ 
      inputEl.current.focus();
    };
    return (
      <>
        <input ref={inputEl} type="text" />
        <button onClick={onButtonClick}>Focus the input</button>
      </>
    );
  }


  import React,{ useState, useRef, useEffect } from 'react'
  const inputRef = useRef<HTMLInputElement>(null)

  useEffect(()=>{
    if(!active) {
      inputRef.current?.focus()
    }
  }, [active])
  ```

### useImperativeHandle

* æ¦‚å¿µï¼šç”¨äºæš´éœ²è‡ªå®šä¹‰çš„æ–¹æ³•æˆ–å±æ€§ç»™çˆ¶ç»„ä»¶ï¼Œä»è€Œä½¿çˆ¶ç»„ä»¶å¯ä»¥ç›´æ¥è°ƒç”¨å­ç»„ä»¶ä¸­çš„æ–¹æ³•æˆ–å±æ€§ã€‚
* ä½¿ç”¨ï¼š`useImperativeHandle`â€‹ æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š`ref â€‹`â€‹å’Œä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚å…¶ä¸­ï¼Œ`ref`â€‹ æ˜¯ä¸€ä¸ªç”± `React.forwardRef â€‹`â€‹åˆ›å»ºçš„ ref å¯¹è±¡ï¼Œç”¨äºåœ¨çˆ¶ç»„ä»¶ä¸­å¼•ç”¨å­ç»„ä»¶ã€‚

  ```js
  useImperativeHandle(ref, createHandle, [deps])

  1.å­ç»„ä»¶æš´éœ²
  import React, { forwardRef, useImperativeHandle, useRef } from 'react';
  const MyInput = forwardRef((props, ref) => {
    const inputRef = useRef();
    useImperativeHandle(ref, () => ({
      focus: () => {
        inputRef.current.focus();
      }
    }));

    return <input type="text" ref={inputRef} />;
  });

  2.çˆ¶ç»„ä»¶å¼•ç”¨å­ç»„ä»¶çš„refè°ƒç”¨è¯¥æ–¹æ³•
  import React, { useRef } from 'react';
  import MyInput from './MyInput';
  function MyForm() {
    const inputRef = useRef();
    const handleSubmit = (e) => {
      e.preventDefault();
      inputRef.current.focus();
    };

    return (
      <form onSubmit={handleSubmit}>
        <MyInput ref={inputRef} />
        <button type="submit">Submit</button>
      </form>
    );
  }
  ```

# è·¯ç”±

ã€€ã€€â€‹`react`â€‹ä¸­ä½¿ç”¨è·¯ç”±çš„`react-router-dom`â€‹æ’ä»¶ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬v6ï¼Œå’Œä¹‹å‰v5ç‰ˆæœ¬å·®è·è¾ƒå¤§ï¼Œä¸»è¦å·®åˆ«æ˜¯åœ¨`hooks`â€‹ä¸Šï¼Œå¾ˆå¤š`api`â€‹åœ¨ç±»ç»„ä»¶ä¸­æ— æ³•è¢«ä½¿ç”¨

## å†…ç½®ç»„ä»¶

```js
<BrowserRouter>  //è·¯ç”±æ¨¡å¼
<HashRouter>  //è·¯ç”±hashæ¨¡å¼
<Route>  //è·¯ç”±å®ä¾‹
<Redirect> V6å·²ç»åºŸå¼ƒï¼Œé‡å®šå‘
<Link>  // aæ ‡ç­¾è·³è½¬
<NavLink>
<Switch> V6å·²ç»åºŸå¼ƒ
```

### Link

```js
æœ‰replaceå‚æ•°ï¼Œé»˜è®¤æ˜¯falseï¼Œå³ä»£è¡¨æ˜¯ä½¿ç”¨replaceè¿˜æ˜¯pushè¿›è¡Œè·³è½¬
<Link to="/home">home<Link>
ç¼–è¯‘å
<a href="/home">home</a>
```

### Route

```js
import Home from "./pages/home";
import About from "./pages/about";
// V5
<Route path="/home" component={Home} />
<Route path="/about" component={About} />

// V6ä¸­ï¼Œrouteç»„ä»¶éœ€è¦è¢«åŒ…è£¹åœ¨ Routes ç»„ä»¶ä¸­
<Routes>  
    <Route path="/home" element={<Home />} />
    <Route path="/about" element={<About />} />
</Routes>

```

### HashRouter

ã€€ã€€è·¯ç”±æ§åˆ¶çš„æœ€å¤–ä¸€å±‚éœ€è¦åŒ…è£¹ `HashRouter â€‹`â€‹æˆ–è€… `BrowserRouter`â€‹ç»„ä»¶    

```js
import React from "react";
import ReactDOM from "react-dom";
import { BrowserRouter } from "react-router-dom";
import App from "./App";

ReactDOM.render(
  <BrowserRouter>
    <App />
  </BrowserRouter>,
  document.getElementById("root")
);
```

### NavLink

ã€€ã€€æ”¯æŒé«˜äº®é¢œè‰²ï¼Œé«˜äº®`class`â€‹é»˜è®¤ä¸º`active`â€‹

* V5é€šè¿‡`activeClassName`â€‹è‡ªå®šä¹‰é€‰ä¸­æ€çš„ç±»å
* V6é€šè¿‡ç»™`className`â€‹ä¼ å…¥**å‡½æ•°**ï¼Œä¾èµ–`isActive`â€‹å‚æ•°ç¡®å®š

```js
// V5
<NavLink className='link' activeClassName='nav-active' to="/home">
    home
</NavLink>
// V6
<NavLink className={({isActive}) => `link ${isActive ? 'nav-active' : ''}`} to="/home">
    home
</NavLink>
```

### Switchï¼ˆRoutesï¼‰

ã€€ã€€å•ä¸€è·¯ç”±åŒ¹é…

ã€€ã€€router V5æœ‰è¿™ä¸ªæ ‡ç­¾ï¼ŒV6å·²è¢«é‡å‘½åä¸º`<Routes>`â€‹ **å•ä¸€åŒ¹é…è·¯ç”±**ï¼Œé€šå¸¸æƒ…å†µä¸‹`path`â€‹å’Œ`component`â€‹æ˜¯`ä¸€ä¸€å¯¹åº”`â€‹çš„å…³ç³»ï¼Œ`Switch`â€‹å¯ä»¥æé«˜è·¯ç”±åŒ¹é…æ•ˆç‡

### Navigate

ã€€ã€€å¯ä»¥ç”¨æ¥å®ç°è·¯ç”±çš„é‡å®šå‘ï¼Œåªè¦è¯¥ç»„ä»¶å‡ºç°ï¼Œå°±ä¼šæ‰§è¡Œé‡å®šå‘çš„è·³è½¬ï¼Œå¹¶è·³è½¬å¯¹åº”çš„toè·¯å¾„ä¸­

```js
v5
import React from "react";
import { Navigate } from "react-router-dom";
// è¿™é‡Œçš„isLoginå°±æ˜¯ç”¨æ¥æ ‡è¯†æ˜¯å¦ç™»å½•ï¼Œå®é™…é¡¹ç›®ä¸€èˆ¬æ˜¯å–reduxé‡Œé¢çš„ç›¸å…³å€¼
const isLogin = false;
const AuthComp = (props) => {
  const { comp:Comp } = props;
  // å¦‚æœç™»å½•å°±æ”¾è¡Œ
  if (isLogin) return Comp;
  // å¦‚æœæ²¡æœ‰ç™»å½•å°±é‡å®šå‘åˆ°Loginç™»å½•é¡µ
  return <Navigate to="/login" replace/>;
};
export default AuthComp;

v6
import { useNavigate } from 'react-router-dom';
export default function withRouter(WrapperComponent){
  return props=>{
    const navigate=useNavigate()
    return <WrapperComponent {...props} router={{navigate}}/>
  }
}
class TestDemo extends Component{
  constructor(props) {
  super(props);
    this.props.router....
  }
 render() {
    return (
      <div>test</div>
    )
  }
}
export default withRouter(TestDemo)
```

ã€€ã€€â€

### withRouter

ã€€ã€€â€‹`withRouter`â€‹å¯ä»¥åŠ å·¥ä¸€èˆ¬ç»„ä»¶ï¼Œè®©ä¸€èˆ¬ç»„ä»¶å…·å¤‡è·¯ç”±ç»„ä»¶æ‰€ç‰¹æœ‰çš„`API`â€‹ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªæ–°ç»„ä»¶

ã€€ã€€V6å·²åºŸå¼ƒï¼ŒV5ä¸­ä¸€èˆ¬ç»„ä»¶(éè·¯ç”±ç»„ä»¶)æƒ³è¦ç”¨è·¯ç”±çš„APIï¼Œæ¯”å¦‚`this.props.history.push()`â€‹ï¼Œéœ€è¦ç”¨`withRouter`â€‹åŒ…ä¸€å±‚

## routeråŸºç¡€

### å¤šçº§è·¯å¾„åˆ·æ–°é¡µé¢æ ·å¼ä¸¢å¤±é—®é¢˜

* â€‹`public/index.html`â€‹ ä¸­å¼•å…¥æ ·å¼ä¸å†™ `./`â€‹ å†™ `/`â€‹
* â€‹`public/index.html`â€‹ ä¸­å¼•å…¥æ ·å¼ä¸å†™ `./`â€‹ å†™ `%PUBLIC_URL%`â€‹
* ä½¿ç”¨`HashRouter`â€‹

### ç²¾å‡†åŒ¹é…ä¸æ¨¡ç³ŠåŒ¹é…

* V5é»˜è®¤æ˜¯**æ¨¡ç³ŠåŒ¹é…**ï¼Œé€šè¿‡`åœ¨Route`â€‹é…ç½®åŠ `exact`â€‹å¼€å¯**ç²¾å‡†åŒ¹é…**
* V6é»˜è®¤å¼€å¯**ç²¾å‡†åŒ¹é…**ï¼ŒåŠ `/*`â€‹å¼€å¯**æ¨¡ç³ŠåŒ¹é…**

### é‡å®šå‘

ã€€ã€€ä¸€èˆ¬å†™åœ¨æ‰€æœ‰è·¯ç”±çš„æœ€ä¸‹æ–¹ï¼Œå½“æ‰€æœ‰è·¯ç”±æ— æ³•åŒ¹é…çš„æ—¶å€™ï¼Œè·³è½¬åˆ°å…œåº•çš„è·¯ç”±

* V5é€šè¿‡`<Redirect to="/home" />`â€‹
* V6å·²åºŸé™¤`Redirect`â€‹æ ‡ç­¾ï¼Œé€šè¿‡`<Route path="*" element={<Navigate to="/home" />} />`â€‹

```js
import { Route, Routes, Navigate, Redirect } from "react-router-dom";
// V5
<Routes className="route">
    <Route path="/home" component={Home} />
    <Route path="/about" component={About} />
    <Redirect to="/home" />
</Routes>

// V6
<Routes className="route">
    <Route path="/home" element={<Home />} />
    <Route path="/about" element={<About />} />
    <Route path="*" element={<Navigate to="/home" />} />
</Routes>
```

### åµŒå¥—è·¯ç”±

* V5æ³¨å†Œå­è·¯ç”±éœ€è¦å†™çˆ¶è·¯ç”±çš„`path`â€‹å€¼

* V6çš„ç‰ˆæœ¬éƒ½ä¸éœ€è¦å†™`/`â€‹ï¼Œåªéœ€è¦åœ°å€å°±è¡Œï¼Œä¹Ÿ`ä¸éœ€è¦ä½ å†™å‰é¢çš„è·¯å¾„`â€‹ï¼Œåªéœ€è¦ä½ å†™ä¸‹ä¸ªè·¯å¾„æ˜¯å•¥å°±è¡Œ

ã€€ã€€è·¯ç”±çš„åŒ¹é…æ˜¯æŒ‰ç…§æ³¨å†Œè·¯ç”±çš„é¡ºåºæ‰§è¡Œçš„

```js
// V5

{/* å¯¼èˆªåŒº */}
{[
    { to: "/home", children: "home" },
    { to: "/about", children: "about" },
].map((nav) => (
    <AppNavLink key={nav.to} {...nav} />
))}

{/* å±•ç¤ºåŒº */}
<Switch className="route">
    <Route path="/home" component={Home} />
    <Route path="/about" component={About} />
    <Redirect to="/home" />
</Switch>

// pages/home/index.js
 <div style={{ display: 'flex' }}>
    <AppNavLink to='/home/message' children="message" />
    <AppNavLink to='/home/news' children="news" />
</div>

<Switch>
    <Route path="/home/message" component={HomeMessage} />
    <Route path="/home/news" component={HomeNews} />
</Switch>

// V6
// app.js
{/* å¯¼èˆªåŒº */}
{[
    { to: "/home", children: "home" },
    { to: "/about", children: "about" },
].map((nav) => (
    <AppNavLink key={nav.to} {...nav} />
))}

{/* å±•ç¤ºåŒº */}
<Routes className="route">
    <Route path="/home/*" element={<Home />} />
    <Route path="/about/*" element={<About />} />
    <Route path="*" element={<Navigate to="/home" />} />
</Routes>

// pages/home/index.js
 <div style={{ display: 'flex' }}>
    <AppNavLink to='message' children="message" />
    <AppNavLink to='news' children="news" />
</div>

<Routes>
    <Route path="message" element={<HomeMessage />} />
    <Route path="news" element={<HomeNews />} />
</Routes>

```

### è·¯ç”±ä¼ å‚

1. paramsï¼šåŠ¨æ€è·¯ç”±ä¼ å‚

    ```js
    // V5
    {/* å‘ç»„ä»¶ä¼ é€’paramså‚æ•° */}
    <Link to={`detail/${msg.id}/${msg.title}`}>{msg.title}</Link>

    {/* å£°æ˜æ¥æ”¶paramså‚æ•° */}
    <Route path="detail/:id/:title" component={HomeMessageDetail} />

    {/* æ¥æ”¶paramså‚æ•° */}
    const {id, title} = this.props.match.params

    //v6
    import {  useParams } from "react-router-dom";
    const params=useParams()
    ```
2. searchï¼šæŸ¥è¯¢å‚æ•°

    â€‹`urlencodedç¼–ç `â€‹ï¼šç±»ä¼¼`key=value&key=value`â€‹çš„ç¼–ç æ–¹å¼ï¼Œå¯ç”¨npmåŒ…`url-parse`â€‹å¤„ç†ï¼Œ

    ```js
    {/* å‘ç»„ä»¶ä¼ é€’searchå‚æ•° */}
    <Link to={`detail?id=${msg.id}&title=${msg.title}`}>{msg.title}</Link>
    {/* å£°æ˜æ¥æ”¶searchå‚æ•°(æ— éœ€å£°æ˜ï¼Œæ­£å¸¸æ³¨å†Œå³å¯) */}
    <Route path="detail" component={HomeMessageDetail} />

    // æ¥æ”¶searchå‚æ•°
    import qs from 'url-parse'
    const {search} = this.props.location
    const {id, title} = qs.parse(search)

    å…¶ä»–æ–¹æ³•ï¼šä½¿ç”¨useSearchParams æˆ– useLocation (è¿™ä¸ªæ–¹æ³•éœ€è¦é¢å¤–å¤„ç†ä¸‹state)
    useSearchParamsè¿”å›çš„æ˜¯ä¸ªæ•°ç»„ï¼Œä¸”æ•°ç»„é‡Œæ˜¯ä¸€ä¸ªå½“å‰å€¼å’Œsetæ–¹æ³•ã€‚
    å¹¶ä¸”æˆ‘ä»¬å–å€¼æ—¶å¸¸å€ŸåŠ©Object.fromEntriesè¿™ä¸ªæ–¹æ³•
    Object.fromEntries() ï¼šå¯ä»¥æŠŠ[[key1,value1],[key2,value2]] è½¬æˆå¯¹è±¡å½¢å¼{key1:value1,key2:value2}

    import React, { useEffect } from "react";
    import { useSearchParams } from "react-router-dom";
    const Login = () => {
      const [searchParams]=useSearchParams()//è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å†…æ˜¯ä¸€ä¸ªå½“å‰å€¼å’Œsetæ–¹æ³•
      const params=Object.fromEntries(searchParams)
      useEffect(()=>{
        console.log('params>>', params);
      },[])
      return <div>Login</div>;
    };

    export default Login;
    ```
3. stateä¼ å‚ï¼šç±»ä¼¼ä¸vueä¸­çš„ `push â€‹`â€‹æ–¹æ³•æºå¸¦å‚æ•°  
    åˆ·æ–°å¹¶ä¸ä¼šæ›´æ–°ï¼Œæ•°æ®å­˜åœ¨`histroy`â€‹ä¸­ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜åå†åˆ·æ–°ä¼šä¸¢å¤±

    ```js
    // V5
    {/* å‘ç»„ä»¶ä¼ é€’stateå‚æ•° */}
    <Link to={{pathname: 'detail', state: {...msg}}}>{msg.title}</Link>
    {/* å£°æ˜æ¥æ”¶stateå‚æ•°(æ— éœ€å£°æ˜ï¼Œæ­£å¸¸æ³¨å†Œå³å¯) */}
    <Route path="detail" component={HomeMessageDetail} />
    // æ¥æ”¶stateå‚æ•°
    const {id, title} = this.props.location.state

    //v6
    import React, { useEffect } from "react";
    import { useLocation } from "react-router-dom";

    const Login = () => {
      const state=useLocation()
      useEffect(()=>{
        console.log('state>>', state);
        //è¯¥stateæ˜¯ä¸ªå¯¹è±¡ï¼Œé‡Œé¢åŒ…å«äº†routeä¿¡æ¯
        //å¦‚pathnameï¼Œsearchï¼Œstateï¼Œkeyï¼Œhashç­‰
      },[])
      return <div>Login</div>;
    };

    export default Login;

    ```

### ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆª

```js
v5 
é€šè¿‡`this.props.history`ä¸Šçš„`push`ã€`replace`ã€`go`ã€`back`ã€`forward`æ–¹æ³•

v6
useNavigate çš„ navigate
naviaget(to)é»˜è®¤å°±æ˜¯history.push
naviaget(to, { replace: true })å°±æ˜¯history.replace
naviaget(to: number)å°±æ˜¯history.go
```

### è·¯ç”±æ¨¡å¼

ã€€ã€€â€‹`BrowserRouter`â€‹ & `HashRouter`â€‹

* **åŸç†**ä¸ä¸€æ ·

  * â€‹`BrowserRouter`â€‹ä½¿ç”¨çš„æ˜¯H5çš„`history`â€‹ APIï¼Œä¸å…¼å®¹IE9ä»¥ä¸‹ç‰ˆæœ¬
  * â€‹`HashRouter`â€‹ä½¿ç”¨çš„æ˜¯URLçš„å“ˆå¸Œå€¼
* **urlè¡¨ç°å½¢å¼**ä¸ä¸€æ ·

  * â€‹`BrowserRouter`â€‹çš„è·¯å¾„ä¸­æ²¡æœ‰`#`â€‹
  * â€‹`HashRouter`â€‹çš„è·¯å¾„ä¸­åŒ…å«`#`â€‹
* **åˆ·æ–°åå¯¹è·¯ç”±**â€‹**`state`**â€‹**å‚æ•°çš„å½±å“**

  * `BrowserRouter`æ²¡æœ‰ä»»ä½•å½±å“â€‹ï¼Œå› ä¸º`state`â€‹å­˜åœ¨`history`â€‹å¯¹è±¡ä¸­
  * â€‹`HashRouter`â€‹åˆ·æ–°åä¼š`å¯¼è‡´è·¯ç”±stateå‚æ•°çš„ä¸¢å¤±`â€‹

### v5ä¸v6

* â€‹`<Switch>`â€‹é‡å‘½åä¸º`<Routes>`â€‹
* â€‹`Route`â€‹ çš„ `render`â€‹ å’Œ `component`â€‹ æ”¹ä¸º `element`â€‹
* åµŒå¥—è·¯ç”±å˜å¾—æ›´ç®€å•
* â€‹`to`â€‹ã€`navigate`â€‹ã€`path`â€‹ ä¸ä»¥ `/`â€‹ å¼€å¤´ï¼Œéƒ½æ˜¯ç›¸å¯¹è·¯å¾„
* ç”¨ `Navigate`â€‹ ä»£æ›¿ `Redirect`â€‹
* ç”¨`useNavigate`â€‹ä»£æ›¿`useHistory`â€‹
* å¤§å°å‡å°‘ï¼šä»`20kb`â€‹åˆ°`8kb`â€‹

### è·¯ç”±æ‡’åŠ è½½

ã€€ã€€ä½¿ç”¨`react`â€‹ä¸­çš„`lazy`â€‹å¼•å…¥ç»„ä»¶ï¼Œä½¿ç”¨`suspense`â€‹ç»„ä»¶åŒ…è£¹æ‡’åŠ è½½çš„ç»„ä»¶

```js
import React, { Component, lazy, Suspense } from "react";

// è·¯ç”±æ‡’åŠ è½½
const Home = lazy(() => import("./pages/home"));
const About = lazy(() => import("./pages/about"));

<Suspense fallback={<div>Loading...</div>}>
  <Routes className="route">
    <Route path="home/*" element={<Home />} />
    <Route path="about/*" element={<About />} />
    <Route path="*" element={<Navigate to="home" />} />
  </Routes>
</Suspense>

Suspense ä¸­çš„ fallback å±æ€§ï¼šå¤„ç†lazyå¤„ç†çš„æ‡’åŠ è½½ç»„ä»¶è¿˜æ²¡åŠ è½½å¤„ç†æ—¶è¦æ˜¾ç¤ºçš„å†…å®¹ï¼Œä¸€èˆ¬åœ¨fallbackä¼ å…¥loadingåŠ¨ç”»æ¥ç¼“è§£ç™½å±é—®é¢˜
<React.Suspense fallback={
        <Spin
          size='large'
          style={{
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center'
          }}
        />
      }>
        <BrowserRouter>
            <App />
        </BrowserRouter>
</React.Suspense>
```

### è·¯ç”±åŒ¹é…è§„åˆ™

* â€‹`/xxx â€‹`â€‹ç¡®å®šçš„è·¯å¾„åï¼Œå¦‚ ï¼š /home è¡¨ç¤ºhomeé¡µé¢ç»„ä»¶èƒ½åŒ¹é…ä¸Šè·¯å¾„åªèƒ½æ˜¯ /home ï¼›
* â€‹`/xxx/:xxx`â€‹ åŠ¨æ€è·¯å¾„åï¼Œ:xxxä¼šåŠ¨æ€å˜åŒ–çš„ ã€‚å¦‚ï¼š/home/:id è¡¨ç¤ºhomeé¡µé¢èƒ½åŒ¹é…ä¸Š /home/11ã€/home/22ã€/home/abcã€/home/xxx ç­‰è·¯å¾„ï¼›
* â€‹`/xxx/:xxx/xxx`â€‹åŠ¨æ€è·¯å¾„ååè·Ÿç¡®å®šè·¯å¾„ï¼Œå¦‚ï¼š /home/:id/abc è¡¨ç¤ºhomeé¡µé¢èƒ½åŒ¹é…ä¸Š /home/11/abcã€/home/22/abc ã€/home/aa/abc ç­‰è·¯å¾„ï¼›
* â€‹`/xxx/* â€‹`â€‹ç¡®å®šè·¯å¾„åï¼Œåé¢å¯ä»¥è·Ÿå¤šä¸ªå­è·¯å¾„ï¼Œå¦‚ï¼š/home/* è¡¨ç¤ºhomeé¡µé¢èƒ½åŒ¹é…ä¸Š /homeã€/home/12ã€/home/abã€/home/cd/123 ç­‰è·¯å¾„ï¼›
* â€‹`/xxx/:xxx/* â€‹`â€‹åŠ¨æ€è·¯å¾„ååä¸é™åˆ¶å­è·¯å¾„ï¼Œå¦‚ï¼š/home/:id/* è¡¨ç¤ºhomeé¡µé¢åŒ¹é… /home/11/abc/bcdã€ /home/22/qwe ç­‰è·¯å¾„ï¼›

### è·¯ç”±é…ç½®åŒ–

ã€€ã€€å¯ä»¥æœ¬èº«åœ¨å†™ç»„ä»¶çš„æ—¶å€™ï¼Œä½¿ç”¨routeæ¥ç›´æ¥å†™ç»„ä»¶ï¼Œä½†æ˜¯è¿™æ ·çš„è¯ï¼Œå°±æ²¡é‚£ä¹ˆç›´è§‚çš„çœ‹åˆ°å„ä¸ªç»„ä»¶é—´çš„è·¯ç”±é—´å…³ç³»ã€‚

ã€€ã€€å¯ä»¥ä½¿ç”¨`useRoutes`â€‹  è¿™ä¸ªé’©å­æ¥ç”ŸæˆåµŒå¥—çš„ç»„ä»¶åŒ…è£¹å½¢æ€ï¼Œæ–¹ä¾¿åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ç®¡ç†ç»„ä»¶é—´çš„è·¯ç”±æ˜ å°„å…³ç³»ã€‚

* routesï¼šrouteså…¶æœ¬èº«æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡Œç»´æŠ¤å„ä¸ªåŒ¹é…å…³ç³»çš„å¯¹è±¡

  ```js
  pathå±æ€§å°±æ˜¯ç»„ä»¶å¯¹åº”çš„è·¯å¾„ï¼›
  elementå±æ€§å°±æ˜¯è¦å¯¹åº”çš„ç»„ä»¶ï¼›
  indexå±æ€§å°±æ˜¯é»˜è®¤è¦å±•ç¤ºçš„é¡µé¢ç»„ä»¶;
  childrenå±æ€§æ˜¯è·¯ç”±åµŒå¥—æ—¶éœ€è¦ç”¨ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œchildrenæ•°ç»„é‡Œçš„å±æ€§å’Œå¤–å±‚ä¸€æ ·ï¼Œå­è·¯ç”±çš„é…ç½®å°±æ˜¯åœ¨childrenå±æ€§é‡Œç»´æŠ¤çš„ã€‚

  import React from 'react';
  import AuthComp from "@/components/authComp/AuthComp";
  import Layout from '@/pages/layout/Layout';
  import lazyLoad from "@/components/lazyLoad";

  const Home = lazyLoad(React.lazy(() => import("@/pages/home/home")));
  const TestContent = lazyLoad(React.lazy(() => import("@/pages/testContent/TestContent")));
  const Login = lazyLoad(React.lazy(() => import("@/pages/login/login")));
  const NotFound = lazyLoad(React.lazy(() => import("@/components/404/notFound")));

  const routes=[
    {
      path:'/',
      element:<AuthComp comp={<Layout/>}/>,
      children: [{
          index: true,
          element: Home,
        },
        {
           path:"/testContent",
           element: TestContent,
          }
        ]},
      {
        	path:'/login',
          element:Login,
      },
      {
         path:'*',
         element:NotFound,
       },
  ]
  export default routes
  ```
* â€‹`useRoutes`â€‹ï¼šä½¿ç”¨`useRoutes`â€‹æ›¿æ¢åŸæ¥çš„`Routes`â€‹éƒ¨åˆ†

  ```js
  import React, { useEffect } from "react";
  import { Routes, Route,useRoutes } from "react-router-dom";
  import routes from '@/router'
  import style from "./index.module.less";

  function App() {
    return (
       <div className={style.App}>
        <div className="content">
         {useRoutes(routes)}
        </div>
       </div>
    );
  }
  export default App;
  ```

# çŠ¶æ€ç®¡ç†

## [redux](https://github.com/reduxjs/redux)

* æ¦‚å¿µï¼šâ€‹`Redux â€‹`â€‹æ˜¯ä¸€ä¸ªä½¿ç”¨å«åš`action`â€‹çš„äº‹ä»¶æ¥ç®¡ç†å’Œæ›´æ–°åº”ç”¨çŠ¶æ€çš„æ¨¡å¼å’Œå·¥å…·åº“ å®ƒä»¥é›†ä¸­å¼`Store`â€‹ï¼ˆcentralized storeï¼‰çš„æ–¹å¼å¯¹æ•´ä¸ªåº”ç”¨ä¸­ä½¿ç”¨çš„çŠ¶æ€è¿›è¡Œé›†ä¸­ç®¡ç†ï¼Œå…¶è§„åˆ™ç¡®ä¿çŠ¶æ€åªèƒ½ä»¥å¯é¢„æµ‹çš„æ–¹å¼æ›´æ–°ã€‚
* è®¾è®¡åŸåˆ™ï¼š

  1. æ•´ä¸ªåº”ç”¨çš„ state è¢«ä¿å­˜åœ¨åŒä¸€ä¸ª store ä¸Š, å¹¶ä¸” store å’Œ view åˆ†ç¦», è¿™å°±æ˜¯é›†ä¸­å¼ store çš„å…·ä½“ä½“ç°
  2. å•å‘æ•°æ®æµï¼šç”¨ state æ¥æè¿°åº”ç”¨ç¨‹åºåœ¨ç‰¹å®šæ—¶é—´ç‚¹çš„çŠ¶å†µã€åŸºäº state æ¥æ¸²æŸ“å‡º Viewã€å½“å‘ç”ŸæŸäº›äº‹æƒ…æ—¶ï¼ˆä¾‹å¦‚ç”¨æˆ·å•å‡»æŒ‰é’®ï¼‰ï¼Œstate ä¼šæ ¹æ®å‘ç”Ÿçš„äº‹æƒ…è¿›è¡Œæ›´æ–°ï¼Œç”Ÿæˆæ–°çš„ stateã€åŸºäºæ–°çš„ state é‡æ–°æ¸²æŸ“ View
  3. åŸºäºä¸å¯å˜æ•°æ®, redux çš„æ‰€æœ‰çŠ¶æ€æ›´æ–°éƒ½æ˜¯ä½¿ç”¨ä¸å¯å˜çš„æ–¹å¼

### ä¸“ä¸šåè¯

* â€‹`action`â€‹ï¼šæ˜¯ä¸€ä¸ªå…·æœ‰ `type`â€‹ å­—æ®µçš„æ™®é€š JavaScript å¯¹è±¡ã€‚ä½ å¯ä»¥å°† `action`â€‹ è§†ä¸ºæè¿°åº”ç”¨ç¨‹åºä¸­å‘ç”Ÿäº†ä»€ä¹ˆçš„äº‹ä»¶

  ```js
  const addTodoAction = {
    type: 'INCREMENT',
    payload: 2
  }
  ```
* â€‹`action creator`â€‹ï¼š æ˜¯ä¸€ä¸ªåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª action å¯¹è±¡çš„å‡½æ•°ã€‚å®ƒçš„ä½œç”¨æ˜¯è®©ä½ ä¸å¿…æ¯æ¬¡éƒ½æ‰‹åŠ¨ç¼–å†™ action å¯¹è±¡

  ```js
  const incrementByAmount = amount => {
    return {
      type: 'INCREMENT',
      payload: amount
    }
  }
  ```
* â€‹`reducer`â€‹ ï¼šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶å½“å‰çš„ `state`â€‹ å’Œä¸€ä¸ª `action`â€‹ å¯¹è±¡ï¼Œå¿…è¦æ—¶å†³å®šå¦‚ä½•æ›´æ–°çŠ¶æ€ï¼Œå¹¶è¿”å›æ–°çŠ¶æ€ã€‚

  ```js
  å‡½æ•°ç­¾åæ˜¯ï¼š(state, action) => newState
  å¯ä»¥å°† reducer è§†ä¸ºä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå®ƒæ ¹æ®æ¥æ”¶åˆ°çš„ actionï¼ˆäº‹ä»¶ï¼‰ç±»å‹å¤„ç†äº‹ä»¶å¯¹stateè¿›è¡Œä¿®æ”¹
  ```
* â€‹`Store`â€‹ï¼šå½“å‰ Redux åº”ç”¨çš„çŠ¶æ€å­˜åœ¨äºä¸€ä¸ªåä¸º store çš„å¯¹è±¡ä¸­ã€‚

  ```js
  storeæ˜¯é€šè¿‡ä¼ å…¥ä¸€ä¸ª reducer æ¥åˆ›å»ºçš„
  å¹¶ä¸”æœ‰ä¸€ä¸ªåä¸º getState çš„æ–¹æ³•ï¼Œå®ƒè¿”å›å½“å‰çŠ¶æ€å€¼
  ```
* â€‹`dispatch`â€‹ï¼šäº‹ä»¶åˆ†å‘æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ª `action`â€‹ å¯¹è±¡ã€‚store å°†æ‰§è¡Œæ‰€æœ‰ reducer å‡½æ•°å¹¶è®¡ç®—å‡ºæ›´æ–°åçš„ stateï¼Œè°ƒç”¨ getState() å¯ä»¥è·å–æ–° stateã€‚

### æ ¸å¿ƒæ–¹æ³•

* â€‹`const store = createStore(reducer, [preloadedState], [enhancer])`â€‹â€‹ï¼š rootStoreï¼ˆå­˜æ”¾ state çš„æ ¹å¯¹è±¡ï¼‰

  ```js
  import { createStore } from "redux"
  const store = createStore(reducer, [preloadedState], [enhancer]);
  const { dispatch, getState, subscribe } = store;
  const store = Redux.createStore(reducer);


  1.reducer ä¸ºä¸€ä¸ª function, åŒ…å« state å’Œ action ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ action ä¸ºä¸€ä¸ªåŒ…å« type çš„å¯¹è±¡, å¹¶è¿”å›æ–°çš„ state
  function reducer(state, action) {
    switch (action.type) {
      case "INCREMENT":
        return state + 1;
      case "DECREMENT":
        return state - 1;
      default:
        return state;
    }
  }
  2.preloadedState ä¸ºåˆå§‹çŠ¶æ€å€¼
  3.enhancerï¼šä¸­é—´ä»¶
  const store = createStore(reducer, undefined, applyMiddleware(thunk, logger));

  ```
* â€‹`store.dispatch(action) â€‹`â€‹â€‹:é€šè¿‡ä¼ å…¥ `action â€‹`â€‹â€‹æ¥æ›´æ–° `state`â€‹â€‹ï¼Œ `action â€‹`â€‹â€‹ä¸ºå¯¹è±¡æƒ…å†µä¸‹ï¼Œæ›´æ–°æ˜¯åŒæ­¥çš„ï¼ˆå¼‚æ­¥æ›´æ–°éœ€è¦ä½¿ç”¨ä¸­é—´ä»¶æ¥å®ç°ï¼‰

  ```js
  // action ä¸ºä¸€ä¸ªå«typeçš„å¯¹è±¡
  store.dispatch(action)

  // action ä¸ºä¸€ä¸ªå«typeçš„å¯¹è±¡ï¼Œ currentReducer ä¸ºä¹‹å‰çš„reducerå¯¹è±¡é›†åˆ
  dispatch(action) {
     currentState = currentReducer(currentState, action)
  }
  ```
* â€‹`store.getState()`â€‹â€‹ï¼šè·å–å½“å‰`state`â€‹â€‹
* â€‹`store.subscribe(()=>{})`â€‹ï¼šè®¢é˜…ï¼Œstateå‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰§è¡Œè¯¥å›è°ƒå‡½æ•°ï¼Œæ¯ä¸ª`dispatch`â€‹éƒ½ä¼šè§¦å‘`subscribe`â€‹ï¼Œ**è¿”å›å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ³¨é”€è®¢é˜…**
* â€‹`const rootReducer = combineReducers({anyReducer})`â€‹ï¼šå°†å¤šä¸ª `reducer â€‹`â€‹èåˆæˆä¸€ä¸ª `reducer`â€‹ï¼Œ å› ä¸º `createStore â€‹`â€‹åªæ¥å—ä¸€ä¸ª `reducer`â€‹ï¼Œ å³åªæ”¯æŒä¸€ä¸ª `rootState`â€‹, `dispatch â€‹`â€‹ä¸ `getState â€‹`â€‹éƒ½æ˜¯é’ˆå¯¹ `rootState â€‹`â€‹çš„

  ```js
  import { combineReducers, createStore } from "redux";
  import todosReducer from "./features/todos/todosSlice";
  import filtersReducer from "./features/filters/filtersSlice";

  const rootReducer = combineReducers({
    //rootStateä¸‹çš„å¤šä¸ªå­çŠ¶æ€æ ‘ï¼Œé€šè¿‡keyï¼Œèµ·åˆ°éš”ç¦»ä½œç”¨
    todos: todosReducer,
    filters: filtersReducer,
  });
  const store = createStore(rootReducer);

  æ³¨æ„ï¼š
  action.type æ²¡æœ‰éš”ç¦», å¦‚æœ 2 ä¸ª reducer éƒ½æœ‰åŒåçš„ action.type, åˆ™ä¼šåŒæ—¶è§¦å‘,
  ä¾æ®æ˜¯const nextStateForKey = reducer(previousStateForKey, action);
  å½“ dispatch æ—¶ï¼Œä¼šè§¦å‘æ‰€æœ‰çš„ reducerï¼Œ ä½†æ˜¯æ¯ä¸ª reducer åªä¼šå¤„ç†è‡ªå·±çš„ state
  ```

### ä¸­é—´ä»¶

* æ¦‚å¿µï¼šå¢å¼º`redux`â€‹â€‹çš„åŠŸèƒ½ï¼Œå¦‚ï¼Œæ­£å¸¸ä½¿ç”¨æ˜¯åŒæ­¥çš„å»ä¿®æ”¹`state`â€‹â€‹ï¼Œä½¿ç”¨ä¸­é—´ä»¶ï¼Œå¯ä»¥åœ¨`dispath`â€‹â€‹ä¸­ä¼ å…¥`function`â€‹â€‹æˆ–è€…`promise`â€‹â€‹ï¼Œæ¥å®ç°å¼‚æ­¥æ›´æ–°`state`â€‹â€‹

  ```js
  createStore çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä½¿ç”¨ applyMiddleware ï¼Œä¼ å…¥ä½¿ç”¨çš„ä¸­é—´ä»¶
  const store = createStore(reducer, undefined, applyMiddleware(thunk, logger));
  ```
* [redux-thunk](https://github.com/reduxjs/redux-thunk)ï¼šä½¿ `dispatch`â€‹â€‹ æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶`dispatch`â€‹â€‹ï¼Œ`getState`â€‹â€‹ï¼Œæ¥è¾¾åˆ°å¼‚æ­¥æ›´æ–°æ•°æ®çš„æ•ˆæœ

  ```js
  //ä»£ç å®ç°
  export default function thunk(extraArgument?: any) {
    // è¿™é‡Œçš„dispatchä¸ºå…¶ä»–ä¸­é—´ä»¶åŠ å¼ºåçš„dispatch
    return ({ dispatch, getState }) => {
      // è¿™é‡Œçš„nextè¡¨ç¤ºçš„æ˜¯ä¸Šä¸€æ¬¡ä¸­é—´ä»¶åŠ å¼ºåçš„dispatchï¼Œå½“åªæœ‰ä¸€ä¸ªä¸­é—´ä»¶æ—¶ï¼Œä¸ºåŸå§‹çš„store.dispatch
      // actionä¸ºå®é™…è°ƒç”¨dispatchæ—¶ä¼ å…¥çš„actionå‚æ•°
      return (next) => (action) => {
        if (typeof action === "function") {
          return action(dispatch, getState, extraArgument);
        }
        return next(action);
      };
    };
  }
  //ä½¿ç”¨
  dispatch((dispatch, getState, extraArgument?: any) => {
    // do something
    setTime(()=>{
      dispatch(action)//{type:xx,value:xxx}
    },1000)
  });
  ```
* [redux-promise](https://github.com/redux-utilities/redux-promise)ï¼šä½¿ `dispatch`â€‹æ¥æ”¶ä¸€ä¸ª`promise`â€‹ï¼Œå¯ä»¥ä½¿ç”¨`promise.then()`â€‹çš„è¿™ç§å†™æ³•

  ```js
  createAction('FETCH_THING', async id => {
    const result = await somePromise;
    return result.someValue;
  });
  createAction('FETCH_THING', async id => {
    const result = await somePromise;
    return result.someValue;
  });
  ```

## [react-redux](https://github.com/reduxjs/react-redux)

ã€€ã€€ä¼ é€é—¨ï¼š[ğŸ¤˜](https://cn.redux.js.org/introduction/getting-started)

### reduxå’Œreact-redux

* [redux ](https://github.com/reduxjs/redux)ä¸º redux core
* [redux-toolkit](https://github.com/reduxjs/redux-toolkit) ä¸º redux çš„å·¥å…·åŒ…
* [redux-thunk](https://github.com/reduxjs/redux-thunk)ä¸º redux çš„ä¸­é—´ä»¶, ä½¿ `dispatch â€‹`â€‹å¯ä»¥æ¥å—å‡½æ•°ï¼Œèµ‹äºˆå…¶æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„èƒ½åŠ›
* [react-redux](https://github.com/reduxjs/react-redux) ä¸º react çš„ redux ç»‘å®šåº“, ä½¿ `react â€‹`â€‹ç»„ä»¶å¯ä»¥ä½¿ç”¨ `redux`â€‹ï¼Œ ä¸”å½“ `redux store`â€‹ å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨æ›´æ–° `react`â€‹ ç»„ä»¶
* æ ¸å¿ƒæ–¹æ³•å’Œ`redux`â€‹æ˜¯ä¸€æ ·çš„

### å®¹å™¨ç»„ä»¶ã€UIç»„ä»¶

ã€€ã€€å®¹å™¨ç»„ä»¶ï¼šè´Ÿè´£å¤„ç†é€»è¾‘

ã€€ã€€UIç»„ä»¶ï¼šè´Ÿè´£æ˜¾ç¤ºå’Œäº¤äº’ï¼Œå†…éƒ¨ä¸å¤„ç†é€»è¾‘ï¼ŒçŠ¶æ€å®Œå…¨ç”±å¤–éƒ¨æŒæ§

### Provider

ã€€ã€€â€‹`<Provider>`â€‹ ç»„ä»¶ä½¿ Redux `store`â€‹ å¯ç”¨äºä»»ä½•éœ€è¦è®¿é—® Redux store çš„åµŒå¥—ç»„ä»¶ã€‚

ã€€ã€€â€‹**è¿™ä¸ªç»„ä»¶çš„ç›®çš„æ˜¯è®©æ‰€æœ‰ç»„ä»¶éƒ½èƒ½å¤Ÿè®¿é—®åˆ°Reduxä¸­çš„æ•°æ®ã€‚ â€‹**â€‹

ã€€ã€€ç”±äº React Redux åº”ç”¨ä¸­çš„ä»»ä½• React ç»„ä»¶éƒ½å¯ä»¥è¿æ¥åˆ° storeï¼Œå› æ­¤å¤§å¤šæ•°åº”ç”¨ä¼šåœ¨é¡¶å±‚æ¸²æŸ“ä¸€ä¸ª `<Provider>`â€‹ï¼Œå°†æ•´ä¸ªåº”ç”¨çš„ç»„ä»¶æ ‘åŒ…è£¹å…¶ä¸­ã€‚

```js
import React from 'react'
import ReactDOM from 'react-dom'
import { Provider } from 'react-redux'
import { App } from './App'
import store from './store'

<Provider store = {store}>
    <App />
<Provider>
```

### connect

ã€€ã€€é«˜é˜¶ç»„ä»¶ï¼šæ¥æ”¶ç»„ä»¶ï¼Œè¿”å›ç»„ä»¶ï¼Œç»™ç»„ä»¶æ·»åŠ åŠŸèƒ½

```js
æ¥æ”¶ä¸¤ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°
default export connect(mapStateToProps, mapDispatchToProps)(MyComponent)

const mapStateToProps = (state) => {
  return {
    // prop : state.xxx  | æ„æ€æ˜¯å°†stateä¸­çš„æŸä¸ªæ•°æ®æ˜ å°„åˆ°propsä¸­
    foo: state.bar
  }
}
å­ç»„ä»¶å¯ä»¥é€šè¿‡ this.props.foo è·å–æ•°æ®


const mapDispatchToProps = (dispatch) => { // é»˜è®¤ä¼ é€’å‚æ•°å°±æ˜¯dispatchï¼ŒæŠŠå„ç§dispatchä¹Ÿå˜æˆäº†propsè®©ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨
  return {
    onClick: () => {
      dispatch({
        type: 'increatment'
      });
    }
  }
};
å­ç»„ä»¶é€šè¿‡ this.props.onClick() æ¥è°ƒç”¨ä¼ é€’æ¥çš„ dispatch
```

## [react-toolkit](https://cn.redux.js.org/introduction/getting-started/)

ã€€ã€€â€‹â€‹![image](assets/image-20230912224500-d11pold.png)â€‹â€‹

### reducer

* ä½œç”¨ï¼šç†è§£æˆä»“åº“ç®¡ç†å‘˜ï¼Œæ•°æ®çš„å¢ã€åˆ ã€æ”¹éƒ½éœ€è¦ç»è¿‡å®ƒã€‚

  ```js
  æ³¨æ„ç‚¹
  1. ä»…ä½¿ç”¨ state å’Œ action è¿›è¡Œæ•°æ®çš„ä¿®æ”¹
  2.ç¦æ­¢ç›´æ¥ä¿®æ”¹ state ã€‚éœ€è¦é€šè¿‡å¤åˆ¶ç°æœ‰çš„state å¹¶å¯¹å¤åˆ¶çš„å€¼è¿›è¡Œæ›´æ”¹çš„æ–¹å¼æ¥å®ç° æ•°æ®çš„ä¿®æ”¹æ“ä½œï¼ˆä¸å¯å˜æ›´æ–°ï¼‰
  3.ç¦æ­¢ä½¿ç”¨å¼‚æ­¥é€»è¾‘ï¼Œä¾èµ–éšæœºå€¼æˆ–å¯¼è‡´å…¶ä»–çš„ å‰¯ä½œç”¨ ä»£ç 

  const countReducer = (state = 0, action) => {
      const { type, payload } = action
      switch (type) {
          case 'incrementCount':
              return state + payload
          case 'decrementCount':
              return state - payload
          default:
              return state
      }
  }
  ```

### action

* ä½œç”¨ï¼šå‚è€ƒçš„è¡Œä¸ºå‡†åˆ™ï¼Œæ˜¯ä¸€ä¸ªæœ‰ `type`â€‹å­—æ®µçš„å¯¹è±¡

  ```js
  const addCount= {
      type: 'add'ï¼Œ
      value:100  //å¯ä»¥æ·»åŠ å…¶ä»–å‚æ•°
  }

  ```

### configureStore

* ä½œç”¨ï¼šåˆ›å»º`store`â€‹ä»“åº“
* å‚æ•°æ˜¯ä¸€ä¸ª`redux`â€‹å‡½æ•°

  ```js
  import { configureStore } from "redux-toolkit"

  const countReducer = (state = 0, action) => {
      const { type, payload } = action
      switch (type) {
          case 'incrementCount':
              return state + payload
          case 'decrementCount':
              return state - payload
          default:
              return state
      }
  }

  // ä½¿ç”¨Redux Toolkitçš„configureStoreæ–¹æ³•åˆ›å»ºstore
  const store = ReduxToolkit.configureStore({
      reducer: {
          counter: countReducer
      },
  })
  ```

### createAction

* ä½œç”¨ï¼šæ–¹ä¾¿åˆ›å»º `action`â€‹ å¯¹è±¡

  ```js
  import { createAction } from  "redux-toolkit"
  const incrementCount = ReduxToolkit.createAction('incrementCount')
  console.log(incrementCount)
  //æ‰“å°
  {
    type:"incrementCount",
    payload:undefined
  }
  ```

### createSlice

* ä½œç”¨ï¼šåˆ‡ç‰‡ï¼Œç±»ä¼¼äºvuxä¸­çš„moduleã€‚**åˆ‡ç‰‡æ˜¯åº”ç”¨ä¸­å•ä¸ªåŠŸèƒ½çš„ Redux reducer é€»è¾‘å’Œ action çš„é›†åˆ**ï¼Œé€šå¸¸ä¸€èµ·å®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚è¯¥åç§°æ¥è‡ªäºå°†æ ¹ Redux çŠ¶æ€å¯¹è±¡æ‹†åˆ†ä¸ºå¤šä¸ªçŠ¶æ€â€œåˆ‡ç‰‡â€ã€‚
* å‚æ•°

  ```js
  å‚æ•°
  1. name ï¼šstringï¼Œè¯¥åˆ‡ç‰‡çš„åå­—
  2. initialState ï¼šåˆ‡ç‰‡çš„åˆå§‹å€¼
  3. reducers ï¼šreducerå‡½æ•°çš„é›†åˆï¼Œæ˜¯ä¸ªå¯¹è±¡å½¢å¼ï¼Œkeyä¸ºreducerå‡½æ•°çš„å‡½æ•°åï¼Œvalueæ˜¯reducerå‡½æ•°
  4. extraReducers ï¼š å¯é€‰å‚æ•°ï¼Œç”¨äºå®šä¹‰é¢å¤–çš„reducerï¼Œé€šå¸¸æ­é…createAsyncThunkä½¿ç”¨ã€‚

  const userInfoSlice = ReduxToolkit.createSlice({
      name: 'userInfo',
      initialState: {name: 'å¼ ä¸‰', age: 18},
      reducers: {
          changeUserNameAction(state, action) {
              state.name = action.payload
          },
          changeUserAgeAction(state, action) {
              state.age = action.payload
          }
      }
     extraReducers: (builder) => {
          builder
              .addCase(changeUserNameAction, (state, action) => {
                  state.name = action.payload
              })
              .addCase(changeUserAgeAction, (state, action) => {
                  state.age = action.payload
              })
              .addDefaultCase((state, action) => {
                  return state
              })
      }
  })

  const { changeUserNameAction, changeUserAgeAction } = userInfoSlice.actions
  console.log(userInfoSlice)
  ```

### createAsyncThunk

* æ¦‚å¿µï¼š`redux`â€‹ä½¿ç”¨redux-thunk æ¥æä¾›å¼‚æ­¥ä¿®æ”¹`state`â€‹çš„èƒ½åŠ›ï¼Œ`redux-toolkit`â€‹å°è£…äº†å¼‚æ­¥è¯·æ±‚çš„æ–¹æ³•
* å‚æ•°ï¼šä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ª å­—ç¬¦ä¸²ï¼Œç”¨äºç”Ÿäº§`action types â€‹`â€‹çš„å‰ç¼€ï¼Œä¸€ä¸ª `payload creator`â€‹ å›è°ƒå‡½æ•°ï¼Œåº”è¯¥è¿”å›ä¸€ä¸ª Promiseã€‚è¿™é€šå¸¸ä½¿ç”¨ async/await è¯­æ³•ç¼–å†™ï¼Œå› ä¸º async å‡½æ•°ä¼šè‡ªåŠ¨è¿”å›ä¸€ä¸ª Promiseã€‚

  ```js
  ä¸¤ä¸ªå‚æ•°
  1.createAsyncThunkçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åŠ¨ä½œçš„åç§°ï¼ŒReduxåŠ¨ä½œåç§°çš„æ ‡å‡†æƒ¯ä¾‹æ˜¯'[slice name]/[action name]' ï¼Œä¾‹å¦‚('auth/login')ã€‚
  2.ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰§è¡Œè¯¥åŠ¨ä½œçš„å¼‚æ­¥å‡½æ•°ï¼Œå®Œæˆåè¿”å›ç»“æœã€‚ ({dispatchï¼ŒgetStateï¼Œextra, requestId, signal, rejectWithValue, fulfillWithValue}) => Promise

  // æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚
  const simulateApiRequest = (value, delay) => {
      return new Promise((resolve) => {
          setTimeout(() => {
              resolve(value)
          }, delay)
      })
  }

  // åˆ›å»ºå¼‚æ­¥thunk action
  const asyncChangeUserNameAction = ReduxToolkit.createAsyncThunk('asyncChangeUserName', async (value) => {
      const response = await simulateApiRequest(value, 1000)
      return response
  })

  const userInfoSlice = ReduxToolkit.createSlice({
      name: 'userInfo',
      initialState: { name: 'å¼ ä¸‰', age: 18 },
      reducers: {
          changeUserNameAction(state, action) {
              state.name = action.payload
          },
          changeUserAgeAction(state, action) {
              state.age = action.payload
          },
          changeUserAgeAddTwo: {
              reducer(state, action) {
                  state.age = action.payload
              },
              prepare(payload) {
                  payload = payload + 2
                  return { payload }
              }
          }
      },
      extraReducers: (builder) => {
          builder
              .addCase(asyncChangeUserNameAction.pending, (state, action) => {
                  console.log('pending')
              })
              .addCase(asyncChangeUserNameAction.fulfilled, (state, action) => {
                  console.log('fulfilled')
                  state.name = action.payload
              })
              .addCase(asyncChangeUserNameAction.rejected, (state, action) => {
                  console.log('rejected')
              })
            //createAsyncThunk å°†ç”Ÿæˆä¸‰ä¸ª action creators å’Œ action typesï¼Œä»¥åŠä¸€ä¸ªåœ¨è°ƒç”¨æ—¶è‡ªåŠ¨ dispatch è¿™äº› actions çš„ thunk å‡½æ•°ã€‚
            //åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œaction creators å’Œå®ƒä»¬ types æ˜¯
            asyncChangeUserNameAction.pendingï¼šuserInfo/asyncChangeUserName/pending
            asyncChangeUserNameAction.fulfilledï¼šuserInfo/asyncChangeUserName/fulfilled
            asyncChangeUserNameAction.rejectedï¼šuserInfo/asyncChangeUserName/rejected
      }
  })

  dispatch(asyncChangeUserNameAction(whg))
  ```

### Provider

* ä½œç”¨ï¼šç»„ä»¶ï¼ŒåŒ…è£¹Appæ ¹ç»„ä»¶ï¼Œç”¨æ¥ä¼ é€’ `store`â€‹
* è°ƒç”¨ useSelector å’Œ useDispatch å¯ä»¥è·å–ä¼ é€’æ¥çš„ `store`â€‹

  ```js
  // index.js
  import React from "react"
  import ReactDOM from "react-dom"
  import App from "./App"
  import { BrowserRouter } from "react-router-dom"

  import store from "./redux/index"
  import { Provider } from "react-redux"

  ReactDOM.render(
    <Provider store={store}>
      <BrowserRouter>
        <React.StrictMode>//ä¸¥æ ¼æ¨¡å¼
          <App />
        </React.StrictMode>
      </BrowserRouter>
    </Provider>,
    document.getElementById("root")
  )
  ```

### useSelector

* ä½œç”¨ï¼šè·å–ä»“åº“çš„æ•°æ®æ•°å€¼ï¼Œè·å–æ˜¯ä¸Šå±‚ç»„ä»¶ä¼ é€’çš„`store`â€‹ï¼Œå¦‚æœæœ‰åˆ†ç‰‡ï¼Œåˆ™éœ€è¦ç‚¹å‡ºæ¥

  ```js
  1.reactç»„ä»¶ä½¿ç”¨ useSeletor é’©å­è·å– store è·å–æ•°æ®
  2.å½¢å‚æ˜¯ state å¯¹è±¡ï¼Œæœ‰è¿”å›å€¼ï¼Œè¿”å›éœ€è¦çš„ state æ•°æ®
  3.åªè¦ redux store æ›´æ–°ï¼Œé€‰æ‹©å™¨ä¼šé‡æ–°è¿è¡Œï¼Œè¿”å›å€¼å‘ç”Ÿå˜åŒ–çš„è¯ï¼Œä½¿ç”¨çš„ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“
  ```
* ä½¿ç”¨

  ```js
  import { useSelector, useDispatch } from "react-redux"
  import { setActiveDate } from "../../redux/modules/date"

  const activeDate = useSelector((state) => state.date.activeDate)
  const dispatch = useDispatch()  //å°±æ˜¯ä»¥å‰çš„ store.dispatch() ,ç°åœ¨æ˜¯ç›´æ¥è¿”å›ä¸€ä¸ª dispatch 
  const setDate = (date) => dispatch(setActiveDate(date))
  ```

### useDispatch

* ä½œç”¨ï¼š  å°† **ä»“ç®¡è¡Œä¸ºå‡†åˆ™action** å‘ç»™ **Reducerä»“åº“ç®¡ç†å‘˜** çš„åŠ¨ä½œï¼Œå¦‚æœç»„ä»¶æƒ³è¦å¯¹ä»“åº“æ‰§è¡ŒæŸäº›æ“ä½œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚

  ```js
  1.React ç»„ä»¶ä½¿ç”¨ useDispatch é’©å­ dispatch action æ¥æ›´æ–° store
  2.åœ¨ç»„ä»¶ä¸­è°ƒç”¨ dispatch(someActionCreator()) æ¥ dispatch action
  ```
* ä½¿ç”¨

  ```js
  import { useSelector, useDispatch } from "react-redux"
  import { setActiveDate } from "../../redux/modules/date"

  const activeDate = useSelector((state) => state.date.activeDate)
  const dispatch = useDispatch()  //å°±æ˜¯ä»¥å‰çš„ store.dispatch() ,ç°åœ¨æ˜¯ç›´æ¥è¿”å›ä¸€ä¸ª dispatch 
  const setDate = (date) => dispatch(setActiveDate(date))
  ```

### ç¤ºä¾‹

```js
import ReduxToolkit from "./redux-toolkit.umd.js"

const showCount = document.getElementsByClassName('show-count')
const addCount = document.getElementsByClassName('add-count')
const minusCount = document.getElementsByClassName('minus-count')
const showUserInfo = document.getElementsByClassName('show-user-info')
const changeUserName = document.getElementsByClassName('change-user-name')
const changeUserAge = document.getElementsByClassName('change-user-age')
const asyncChangeUserName = document.getElementsByClassName('async-change-user-name')

const incrementCount = ReduxToolkit.createAction('INCREMENT_COUNT')
const decrementCount = ReduxToolkit.createAction('DECREMENT_COUNT')

const countReducer = ReduxToolkit.createReducer(0, (builder) => {
    builder
        .addCase(incrementCount, (state, action) => {
            return state + action.payload
        })
        .addCase(decrementCount, (state, action) => {
            return state - action.payload
        })
        .addMatcher((action) => action.payload === 100, (state, action) => {
            return state + action.payload
        })
        .addDefaultCase((state, action) => {
            return state
        })
})

// æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚
const simulateApiRequest = (value, delay) => {
    return new Promise((resolve) => {
        setTimeout(() => {
            resolve(value)
        }, delay)
    })
}

// åˆ›å»ºå¼‚æ­¥thunk action
const asyncChangeUserNameAction = ReduxToolkit.createAsyncThunk('asyncChangeUserName', async (value) => {
    const response = await simulateApiRequest(value, 1000)
    return response
})

const userInfoSlice = ReduxToolkit.createSlice({
    name: 'userInfo',
    initialState: { name: 'å¼ ä¸‰', age: 18 },
    reducers: {
        changeUserNameAction(state, action) {
            state.name = action.payload
        },
        changeUserAgeAction(state, action) {
            state.age = action.payload
        },
        changeUserAgeAddTwo: {
            reducer(state, action) {
                state.age = action.payload
            },
            prepare(payload) {
                payload = payload + 2
                return { payload }
            }
        }
    },
    extraReducers: (builder) => {
        builder
            .addCase(asyncChangeUserNameAction.pending, (state, action) => {
                console.log('pending')
            })
            .addCase(asyncChangeUserNameAction.fulfilled, (state, action) => {
                console.log('fulfilled')
                state.name = action.payload
            })
            .addCase(asyncChangeUserNameAction.rejected, (state, action) => {
                console.log('rejected')
            })
    }
})

const { changeUserNameAction, changeUserAgeAction, changeUserAgeAddTwo } = userInfoSlice.actions

const loggerMiddleware = (store) => (next) => (action) => {
    console.log('dispatching', action)
    const result = next(action)
    console.log('next state', store.getState())
    return result
}

// ä½¿ç”¨Redux Toolkitçš„configureStoreæ–¹æ³•åˆ›å»ºstore
const store = ReduxToolkit.configureStore({
    reducer: {
        count: countReducer,
        userInfo: userInfoSlice.reducer
    },
    middleware: [loggerMiddleware, ...ReduxToolkit.getDefaultMiddleware()]
})

const { dispatch, getState, subscribe } = store

const assignCount = () => {
    showCount[0].innerHTML = getState().count
}
const assignUserInfo = () => {
    const userInfo = getState().userInfo
    showUserInfo[0].innerHTML = `å§“åï¼š${userInfo.name}ï¼Œå¹´é¾„ï¼š${userInfo.age}`
}

assignCount()
assignUserInfo()

subscribe(assignCount)
subscribe(assignUserInfo)

const boundActionsCreators = ReduxToolkit.bindActionCreators({
    incrementCount,
    decrementCount,
    changeUserNameAction,
    changeUserAgeAction,
    changeUserAgeAddTwo,
    asyncChangeUserNameAction
}, dispatch)

addCount[0].addEventListener('click', () => {
    boundActionsCreators.incrementCount(3)
})

minusCount[0].addEventListener('click', () => {
    boundActionsCreators.decrementCount(2)
})

changeUserName[0].addEventListener('click', () => {
    boundActionsCreators.changeUserNameAction('æå››')
})

changeUserAge[0].addEventListener('click', () => {
    boundActionsCreators.changeUserAgeAddTwo(20)
})

asyncChangeUserName[0].addEventListener('click', () => {
    boundActionsCreators.asyncChangeUserNameAction('ç‹äº”')
})
```

## [redux-persist](https://github.com/rt2zz/redux-persist)

ã€€ã€€â€‹`redux â€‹`â€‹çš„æŒä¹…åŒ–æ’ä»¶

* å®‰è£…

  ```js
  yarn add redux-persist --save
  ```
* é…ç½®

  ```js
  // configureStore.js 
  import  {  createStore  }  from  'redux' 
  import  {  persistStore ,  persistReducer  }  from  'redux-persist' 
  import  storage  from  'redux-persist/lib/storage'  // é»˜è®¤ä¸ºlocalStorage for web 
  import commonReducers from './reducer';
  const reducers = combineReducers({
    ...commonReducers,
  });

  const persistConfig  =  { 
    key : 'root' , 
    storage , 
  } 

  const persistedReducer  =  persistReducer ( persistConfig , rootReducer ) 

  export  default  ( )  =>  { 
    let  store  =  createStore ( persistedReducer ) 
    let  persistor  =  persistStore ( store ) 
    return  { store , persistor } 
  }
  ```
* ä½¿ç”¨

  ```js
  è¯¥PersistGateç»„ä»¶æ˜¯å»¶è¿Ÿæ¸²æŸ“ï¼Œç›´åˆ°æŒä¹…åŒ–å®Œæˆï¼Œ
  loading = { null }ä¸­ï¼Œå¯ä»¥æ›¿æ¢ä¸ºæˆ‘ä»¬è‡ªå·±çš„loadingç»„ä»¶ï¼šloading={<Loading />}
  const  App  =  ( )  =>  { 
    return  ( 
      < Provider  store = { store } > 
        < PersistGate  loading = { null }  persistor = { persistor } > 
          < RootComponent  / > 
        < / PersistGate > 
      < / Provider > 
    ) ; 
  } ;
  ```
* é…ç½®å‚æ•°

  ```js
  1. persistReducer(config, reducer)ï¼š
  å‚æ•°ï¼š
  configï¼š
  æ‰€éœ€é…ç½®ï¼š key, storageï¼ˆstorageé»˜è®¤ä¸ºlocalStorageï¼‰
  å€¼å¾—æ³¨æ„çš„å…¶ä»–é…ç½®ï¼š whitelist, blacklist, version, stateReconciler, debug
  reducer:ä»»ä½•reduceréƒ½å¯ä»¥ä½¿ç”¨ï¼Œé€šå¸¸æ˜¯è¿”å›é¡¶çº§çš„reducer--combineReducers
   
  è¿”å›å€¼ï¼š
  ä¸€ä¸ªç»è¿‡å¤„ç†çš„reducer
   
  2. persistStore(store, [config, callback])
  å‚æ•°ï¼š
  store:redux store,å°†åšæŒä¹…åŒ–å­˜å‚¨
  config: å¦‚æœè¦é¿å…åœ¨è°ƒç”¨åç«‹å³å¼€å§‹æŒä¹…åŒ–persistStoreï¼Œè¯·è®¾ç½®é€‰é¡¹ manualPersistã€‚
  ç¤ºä¾‹ï¼š{ manualPersist: true }ç„¶åå¯ä»¥åœ¨ä»»ä½•æ—¶å€™ä½¿ç”¨persistor.persist().
  å¦‚æœåœ¨è¿›è¡ŒpersistStoreå‘¼å«æ—¶æ‚¨çš„å­˜å‚¨å°šæœªå‡†å¤‡å¥½ï¼Œæ‚¨é€šå¸¸å¸Œæœ›è¿™æ ·åšã€‚
  callback:å›è°ƒå‡½æ•°
  è¿”å›å€¼ï¼š
  è¿”å›æŒä¹…åŒ–å¯¹è±¡

  3 .persistor
  æŒä¹…åŒ–å¯¹è±¡ç”± persistStore ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è¿”å›ï¼š
  .purge()
  ä»ç£ç›˜æ¸…é™¤çŠ¶æ€å¹¶è¿”å›ä¸€ä¸ªæ‰¿è¯º
  .flush()
  ç«‹å³å°†æ‰€æœ‰æŒ‚èµ·çŠ¶æ€å†™å…¥ç£ç›˜å¹¶è¿”å›ä¸€ä¸ªæ‰¿è¯º
  .pause()
  æš‚åœæŒä¹…æ€§
  .persist()
  æ¢å¤åšæŒ

  ```
* ç™½åå•è®¾ç½®

  ```js
  // BLACKLIST 
  const  persistConfig  =  { 
    key : 'root' , 
    storage : storage , 
    blacklist : [ 'tag' ]  // ä¸ä¼šè¢«æŒä¹…åŒ–
  } ; 

  // WHITELIST 
  const  persistConfig  =  { 
    key : 'root' , 
    storage : storage , 
    whitelist : [ 'auth' ]  // ä¼šè¢«æŒä¹…åŒ–
  } ;
  ```

## immutable

ã€€ã€€â€‹`immutable`â€‹ ï¼šä¸å¯å˜æ•°æ®

ã€€ã€€â€‹`react`â€‹åœ¨æ”¹å˜çŠ¶æ€çš„æ—¶å€™ï¼Œæ˜¯ä¸èƒ½ç›´æ¥å»ä¿®æ”¹`state`â€‹çš„å€¼ï¼Œéœ€è¦é€šè¿‡å¤åˆ¶`state`â€‹çš„å€¼ï¼Œç„¶åä¿®æ”¹æ‹·è´çš„æ•°æ®å¹¶è¿”å›æ¥è¾¾åˆ°ä¿®æ”¹`state`â€‹çš„æ•ˆæœã€‚

ã€€ã€€çŠ¶æ€çš„æ•°æ®ç»“æ„ç®€å•çš„æƒ…å†µä¸‹è¿˜å¥½ï¼Œä½¿ç”¨æ–¹æ³•æˆ–è€…è§£æ„èµ‹å€¼ï¼Œå¤åˆ¶æ•°æ®æ¯”è¾ƒæ–¹ä¾¿ã€‚å¦‚æœæ•°æ®ç»“æ„æ¯”è¾ƒå¤æ‚çš„è¯ï¼Œé‚£æ•°æ®çš„å¤åˆ¶å°±å¾ˆéº»çƒ¦äº†ï¼Œæ‰€ä»¥ ä½¿ç”¨ `immutable`â€‹ è¿™ä¸ªåº“ï¼Œä¼šè¿”å›ä¸€ä¸ªä¸å¯å˜æ•°æ®å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥ç›´æ¥ä¿®æ”¹æ•°æ®è€Œä¸å½±å“åŸæ•°æ®

ã€€ã€€â€‹`Immutable Data`â€‹ä¸å¯æ›´æ”¹æ•°æ®ï¼Œä¸€æ—¦åˆ›å»ºï¼Œå¯¹`Immutable`â€‹å¯¹è±¡çš„ä»»ä½•æ“ä½œéƒ½å°†è¿”å›ä¸€ä¸ªæ–°çš„Immutable Dataï¼Œå…¶å®ç°åŸç†æ˜¯`Persistent Data Structure`â€‹**ï¼ˆæŒä¹…åŒ–æ•°æ®ç»“æ„ï¼‰** å³ä½¿ç”¨æ—§æ•°æ®åˆ›å»ºæ–°æ•°æ®æ—¶ï¼Œè¦ä¿è¯æ—§æ•°æ®å¯ä»¥ä½¿ç”¨ä¸”ä¸å˜ã€‚åŒæ—¶ä¸ºäº†é¿å…deepclone,æ·±åº¦æ‹·è´å¯¹äºæ€§èƒ½çš„æŸè€—ï¼Œ`Immutable â€‹`â€‹ä½¿ç”¨äº†[Structural Sharingï¼ˆç»“æ„å…±äº«ï¼‰](https://link.juejin.cn?target=https%3A%2F%2Flink.jianshu.com%2F%3Ft%3Dhttps%253A%252F%252Fzhuanlan.zhihu.com%252Fp%252F27133830%253Fgroup_id%253D851585269567213568 "https://link.jianshu.com/?t=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F27133830%3Fgroup_id%3D851585269567213568")ï¼Œå½“å¯¹è±¡æ ‘ä¸­ä¸€ä¸ªèŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªä¼šæ”¹å˜è¯¥å­èŠ‚ç‚¹ä»¥åŠå—å…¶å½±å“çš„çˆ¶èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹å…±äº«ã€‚

ã€€ã€€[ä¼ é€é—¨](https://juejin.cn/post/6940640420527341599?searchId=2023091422130758558F4B8842235BD464#heading-9)

* ä¸‹è½½

  ```js
  npm i immutable
  ```
* æ–¹æ³•ï¼šä½¿ç”¨ `Map`â€‹è¿”å›çš„ `immutable`â€‹å¯¹è±¡çš„æ–¹æ³•å’ŒMapå¯¹è±¡çš„æ–¹æ³•ç±»ä¼¼

  ```js
  import {Map,Listï¼ŒfromJS} from 'immutable'

  1.  
  const immutableData = Map({name:"å¼ ä¸‰"}) // æŠŠæ™®é€šjså¯¹è±¡è½¬åŒ–æˆ immutable å¯¹è±¡ ä¸è¿‡è¿™ä¸ªæ–¹æ³•åªèƒ½è½¬åŒ–ç¬¬ä¸€å±‚çš„æ•°æ®ï¼Œå¦‚æœé‡Œé¢åµŒå¥—å¯¹è±¡çš„è¯ï¼Œåˆ™éœ€è¦å†æ¬¡è½¬åŒ–
  const immutableData = Map({
    name:'å¼ ä¸‰',
    obj:Map({age:20})
  })

  2.
  const arr=List([1,2,3])//ä½¿ç”¨listæ–¹æ³•ï¼Œå¯ä»¥æŠŠ æ•°ç»„ è½¬æˆ immutable å¯¹è±¡ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡çš„ä¸€äº›æ–¹æ³•çš„åç§°å’Œæ™®é€šæ•°ç»„å¯¹è±¡çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œå‡å°‘å¿ƒæ™ºè´Ÿæ‹…
  arr.push(4)//æ·»åŠ æ•°æ®
  const data=arr.toJs()//è½¬æˆæ™®é€šjsæ•°ç»„

  3.  
  const immutableData = fromJS(obj) //æ‡’å¾—è‡ªå·±ä¸€å±‚å±‚å»ä½¿ç”¨mapå»åµŒå¥—æ•°æ®çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªï¼Œä¸è¿‡è¿™ä¸ªæ˜¯æ·±æ‹·è´ï¼Œæ¯”è¾ƒåƒæ€§èƒ½ä¸€äº›


  4.  
  immutableData.get(key) è¯»å–æ•°æ®
  const name = immutableData.get('name')

  5. 
  immutableData.set(key,newValue)
  const newData=oldData.set('name','changename')
  // setæ–¹æ³•å¯ä»¥é“¾å¼ä½¿ç”¨
  const newData=oldData.set('name','changename').set('age',100)

  6.
  immutableData.toJS()//ä½¿ç”¨ immutable å¯¹è±¡ï¼Œè½¬åŒ–æˆæ™®é€š js å¯¹è±¡
  ```
* å¯¹è±¡è®¾ç½®å‚æ•°ï¼š`setIn([key1,key1-1],newValue)`â€‹ å¯ä»¥ä½¿ç”¨å±‚çº§æ–¹æ³•è®¾ç½®æ•°æ®ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•°ç»„ï¼ŒæŒ‰å±‚çº§ä¾æ¬¡ä¼ å…¥å±æ€§åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¦è®¾ç½®çš„å±æ€§å€¼

  ```js
  import React, { Component } from 'react'
  import {fromJS} from 'immutable'
  export default class member extends Component {
      state={
          userInfo:fromJS({
              name:'test',
              age:100,
              children:{
                  name:'one'
              }
          })
      }
    render() {
      return (
        <div>
            <p>{this.state.userInfo.get('children').get('name')}</p>
            <button onClick={()=>{
               this.setState({
                   userInfo:this.state.userInfo.setIn(['children','name'],'changeone')
               })
            }}>setInä¿®æ”¹</button>
        </div>
      )
    }
  }
  ```
* æ•°ç»„è®¾ç½®å‚æ•°ï¼š`updataIn([key1,key1-1],()=>{newArr})`â€‹ï¼šæ•°ç»„æ›´æ–°æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•°ç»„ï¼ŒåŒsetInä¸€æ ·ï¼Œä¸ºå±‚çº§å±æ€§åï¼Œç¬¬äºŒä¸ªä¸ºå›è°ƒå‡½æ•°ï¼ŒupdataInæ–¹æ³•ä¼šå°†immutableæ•°ç»„æ›´æ–°ä¸ºå›è°ƒå‡½æ•°ä¸­è¿”å›çš„æ•°ç»„

  ```js
  import React, { Component } from 'react'
  import {fromJS} from 'immutable'
  export default class member extends Component {
      state={
          userInfo:fromJS({
              arr:[1,2,3,4]
          })
      }
    render() {
      return (
        <div>
            <button onClick={()=>{
               this.setState({
                   userInfo:this.state.userInfo.update(['arr'],()=>[5,6,7,8])
               },()=>{
                   console.log(this.state.userInfo)
               })
            }}>updateInä¿®æ”¹</button>
        </div>
      )
    }
  }

  ```
* ä½¿ç”¨æ–¹æ³•

  ```js
  1.åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå°±ä½¿ç”¨ immutable å¤„ç†æ•°æ®ï¼Œæ•°æ®ä¿®æ”¹çš„æ—¶å€™ï¼Œå°±ç›´æ¥ä¿®æ”¹ immutableData æ•°æ®ï¼Œåç»­ç›´æ¥è¿”å›newImmutableData
  2.åœ¨æ•°æ®ä¿®æ”¹æ—¶å…ˆå°†stateä¸­å°†æ•°æ®è·å–è½¬ä¸ºimmutableä¸å¯å˜æ•°æ®ã€‚ä¿®æ”¹æ•°æ®æ—¶è¦ä½¿ç”¨immutableçš„APIã€‚ç„¶åå†å°†æ•°æ®è½¬ä¸ºæ™®é€šå¯¹è±¡åè®¾ç½®å›stateï¼Œstateä¸­çš„æ•°æ®å§‹ç»ˆæ˜¯æ™®é€šå¯¹è±¡ã€‚
  ```
